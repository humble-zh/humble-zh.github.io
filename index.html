<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>Zhihong&#39;s Blog</title>
    <meta name="author" content="Zhihong Li" />
    <meta name="keywords" content="zhbox" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="Zhihong&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
<meta name="generator" content="Hexo 5.3.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">Zhihong&#39;s Blog</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item active" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/zhbox">
                <span class="nav-text">中盒</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://humble-zh.github.io"></form>

        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/">
                    <img src="/images/avatar.jpg" title="Zhihong Li">
                </a>
            </div>
            
            <div class="author-name">Zhihong Li</div>
            <div class="author-work">Program Monkey</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">GuangZhou, China</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/humble-zh/zhbox" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewBox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512 32.12c-265.004 0-479.88 220.23-479.88 492.090 0 217.446 137.536 401.684 328.202 466.81 23.994 4.498 32.778-10.712 32.778-23.78 0-11.782-0.428-42.632-0.642-83.764-133.466 29.778-161.744-65.984-161.744-65.984-21.852-56.772-53.344-71.982-53.344-71.982-43.49-30.636 3.214-29.992 3.214-29.992 48.202 3.428 73.482 50.772 73.482 50.772 42.846 75.196 112.258 53.558 139.68 40.918 4.284-31.706 16.71-53.558 30.42-65.77-106.474-12.426-218.516-54.63-218.516-243.152 0-53.772 18.638-97.69 49.274-131.966-4.928-12.426-21.424-62.556 4.714-130.252 0 0 40.276-13.282 131.966 50.344 38.348-10.926 79.266-16.282 120.184-16.496 40.704 0.214 81.836 5.57 120.184 16.496 91.692-63.626 131.752-50.344 131.752-50.344 26.136 67.698 9.64 117.828 4.714 130.252 30.636 34.492 49.274 78.408 49.274 131.966 0 188.952-112.258 230.514-219.16 242.724 17.138 15.21 32.564 45.202 32.564 91.048 0 65.77-0.642 118.898-0.642 134.966 0 13.068 8.57 28.492 32.992 23.566 191.094-64.912 328.418-249.152 328.418-466.382 0-271.86-214.874-492.090-479.88-492.090z"></path>
</svg>

                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                
    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/05/26/markdown_mermaid%E7%AC%94%E8%AE%B0/">markdown_mermaid笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-05-26T07:32:41.000Z" itemprop="datePublished">2022-05-26</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/markdown/" rel="tag">markdown</a>, <a class="article-tag-link" href="/tags/mermaid/" rel="tag">mermaid</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h1 id="mermaid-概述"><a href="#mermaid-概述" class="headerlink" title="mermaid 概述"></a>mermaid 概述</h1><ul>
<li><p>怎么使用Mermaid？</p>
<ul>
<li>使用特定的Mermaid渲染器；</li>
<li>使用集成了Mermaid渲染功能的Markdown编辑器，如<a target="_blank" rel="noopener" href="https://www.typora.io/">Typora</a>。使用时，需要将代码块的语言选择为Mermaid。</li>
<li>行首加<code>%%</code>代表注释</li>
</ul>
</li>
<li><p>Mermaid能绘制哪些图？</p>
<ul>
<li>饼状图：使用<code>pie</code>关键字，具体用法后文将详细介绍</li>
<li>流程图：使用<code>graph</code>关键字，具体用法后文将详细介绍</li>
<li>序列图：使用<code>sequenceDiagram</code>关键字</li>
<li>甘特图：使用<code>gantt</code>关键字</li>
<li>类图：使用<code>classDiagram</code>关键字</li>
<li>状态图：使用<code>stateDiagram</code>关键字</li>
<li>用户旅程图：使用<code>journey</code>关键字</li>
</ul>
</li>
<li><p>在线渲染器：<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid-live-editor/edit#pako:eNo1zcEKwjAMBuBXCTnvIqKMXp130WsvcQmzuLajS4Ux9u5WZv9T8uWHrNhHFjQ4OQF1OgrcRGcgjpMKw3OBTxxzUJE02wAlFrs4zBbBwLE9V7uQ7taeKt0rHf5Ugw16SZ4cl8fr72ZRX-LFoikjU3pbtGErvTwxqVzZaUxoNGVpkLLGxxL6uu-dztGQyO-4fQGs5EML">Online FlowChart &amp; Diagrams Editor</a></p>
</li>
</ul>
<hr>
<h2 id="饼状图-pie"><a href="#饼状图-pie" class="headerlink" title="饼状图(pie)"></a>饼状图(pie)</h2><p>数值最多支持2位小数——数据会以百分比的形式展示</p>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pie</span><br><span class="line">    title 为什么总是宅在家里？</span><br><span class="line">    &quot;喜欢宅&quot; : 15</span><br><span class="line">    &quot;天气太热或太冷&quot; : 20</span><br><span class="line">    &quot;穷&quot; : 500</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pie</span><br><span class="line">    title 为什么总是宅在家里？</span><br><span class="line">    &quot;喜欢宅&quot; : 15</span><br><span class="line">    &quot;天气太热或太冷&quot; : 20</span><br><span class="line">    &quot;穷&quot; : 500</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="流程图-graph"><a href="#流程图-graph" class="headerlink" title="流程图(graph)"></a>流程图(graph)</h2><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B -- Yes --&gt; C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B -- No ----&gt; E[End];</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B -- Yes --&gt; C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B -- No ----&gt; E[End];</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="方向"><a href="#方向" class="headerlink" title="方向"></a>方向</h3><p>用于开头，声明流程图的方向。</p>
<ul>
<li><code>graph</code>或<code>graph TB</code>或<code>graph TD</code>：从上往下</li>
<li><code>graph BT</code>：从下往上</li>
<li><code>graph LR</code>：从左往右</li>
<li><code>graph RL</code>：从右往左</li>
</ul>
<h3 id="结点"><a href="#结点" class="headerlink" title="结点"></a>结点</h3><ul>
<li>无名字的结点：直接写内容，此时结点边框为方形；节点内容不能有空格</li>
<li>有名字的结点：节点名后书写内容，内容左右有特定符号，结点边框由符号决定；节点内容可以有空格</li>
</ul>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">    默认方形</span><br><span class="line">    id1[方形]</span><br><span class="line">    id2(圆边矩形)</span><br><span class="line">    id3([体育场形])</span><br><span class="line">    id4[[子程序形]]</span><br><span class="line">    id5[(圆柱形)]</span><br><span class="line">    id6((圆形))</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">    默认方形</span><br><span class="line">    id1[方形]</span><br><span class="line">    id2(圆边矩形)</span><br><span class="line">    id3([体育场形])</span><br><span class="line">    id4[[子程序形]]</span><br><span class="line">    id5[(圆柱形)]</span><br><span class="line">    id6((圆形))</span><br></pre></td></tr></table></figure>
<hr>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">    id1&#123;菱形&#125;</span><br><span class="line">    id2&#123;&#123;六角形&#125;&#125;</span><br><span class="line">    id3[&#x2F;平行四边形&#x2F;]</span><br><span class="line">    id4[\反向平行四边形\]</span><br><span class="line">    id5[&#x2F;梯形\]</span><br><span class="line">    id6[\反向梯形&#x2F;]</span><br><span class="line">    id7&gt;非对称形状]</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">    id1&#123;菱形&#125;</span><br><span class="line">    id2&#123;&#123;六角形&#125;&#125;</span><br><span class="line">    id3[&#x2F;平行四边形&#x2F;]</span><br><span class="line">    id4[\反向平行四边形\]</span><br><span class="line">    id5[&#x2F;梯形\]</span><br><span class="line">    id6[\反向梯形&#x2F;]</span><br><span class="line">    id7&gt;非对称形状]</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="连线样式"><a href="#连线样式" class="headerlink" title="连线样式"></a>连线样式</h3><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a--&gt;b--文本1--&gt;c--&gt;|文本2|d</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a--&gt;b--文本1--&gt;c--&gt;|文本2|d</span><br></pre></td></tr></table></figure>
<hr>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a&#x3D;&#x3D;&gt;b&#x3D;&#x3D;文本&#x3D;&#x3D;&gt;c</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a&#x3D;&#x3D;&gt;b&#x3D;&#x3D;文本&#x3D;&#x3D;&gt;c</span><br></pre></td></tr></table></figure>
<hr>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a-.-&gt;b-.文本.-&gt;c</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a-.-&gt;b-.文本.-&gt;c</span><br></pre></td></tr></table></figure>
<hr>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a---b</span><br><span class="line">    b--文本1---c</span><br><span class="line">    c---|文本2|d</span><br><span class="line">    d&#x3D;&#x3D;&#x3D;e</span><br><span class="line">    e&#x3D;&#x3D;文本3&#x3D;&#x3D;&#x3D;f</span><br><span class="line">    f-.-g</span><br><span class="line">    g-.文本.-h</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    a---b</span><br><span class="line">    b--文本1---c</span><br><span class="line">    c---|文本2|d</span><br><span class="line">    d&#x3D;&#x3D;&#x3D;e</span><br><span class="line">    e&#x3D;&#x3D;文本3&#x3D;&#x3D;&#x3D;f</span><br><span class="line">    f-.-g</span><br><span class="line">    g-.文本.-h</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>其他连线：需要将<code>graph</code>关键字改为<code>flowchart</code>，除了新增加的连线形式外，上面三种线的渲染效果也会不同 (好像网页显示不了<code>&lt;--&gt;</code>)</li>
</ul>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A o--o B</span><br><span class="line">    B &lt;--&gt; C</span><br><span class="line">    C x--x D</span><br><span class="line">    旧连线 --文本--&gt; 也会不同</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A o--o B</span><br><span class="line">    B &lt;--&gt; C</span><br><span class="line">    C x--x D</span><br><span class="line"></span><br><span class="line">    旧连线 --文本--&gt; 也会不同</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>延长连线：增加相应字符即可，如下图中的B到E，连线中增加了一个<code>-</code>。字符可多次添加。</li>
</ul>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ---&gt;|No| E[End];</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ---&gt;|No| E[End];</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="连线形式"><a href="#连线形式" class="headerlink" title="连线形式"></a>连线形式</h3><h4 id="直链"><a href="#直链" class="headerlink" title="直链"></a>直链</h4><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   A -- text --&gt; B -- text2 --&gt; C</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   A -- text --&gt; B -- text2 --&gt; C</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="多重链"><a href="#多重链" class="headerlink" title="多重链"></a>多重链</h4><p>可以使用<code>&amp;</code>字符，或单个描述</p>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">   a --&gt; b &amp; c--&gt; d</span><br><span class="line">   A &amp; B--&gt; C &amp; D</span><br><span class="line">    X --&gt; M</span><br><span class="line">    X --&gt; N</span><br><span class="line">    Y --&gt; M</span><br><span class="line">    Y --&gt; N</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">   a --&gt; b &amp; c--&gt; d</span><br><span class="line">   A &amp; B--&gt; C &amp; D</span><br><span class="line">    X --&gt; M</span><br><span class="line">    X --&gt; N</span><br><span class="line">    Y --&gt; M</span><br><span class="line">    Y --&gt; N</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h3><p>如果文本中有字符可以用双引号：</p>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A[&quot;括号 (text)&quot;]---B[&quot;中括号 [text]&quot;]</span><br></pre></td></tr></table></figure>
</pre>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A[&quot;括号 (text)&quot;]---B[&quot;中括号 [text]&quot;]</span><br></pre></td></tr></table></figure>
<hr>
<p>如果文本中要使用双引号或者其它更多特殊字符，可以使用<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/charsets/index.asp">HTML 实体</a>来表示：</p>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A[&quot;引号#quot;&quot;]---B[&quot;美元符号#36;&quot;]---C[&quot;笑脸#128512;&quot;]</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A[&quot;引号#quot;&quot;]---B[&quot;美元符号#36;&quot;]---C[&quot;笑脸#128512;&quot;]</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>实例：朱元璋家谱简图，圆圈代表皇帝</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">emperor((朱八八))-.子.-&gt;father(朱五四)-.子.-&gt;朱四九-.子.-&gt;朱百六</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">朱雄英--长子--&gt;朱标--长子--&gt;emperor</span><br><span class="line">emperor2((朱允炆))--次子--&gt;朱标</span><br><span class="line">朱樉--次子--&gt;emperor</span><br><span class="line">朱棡--三子--&gt;emperor</span><br><span class="line">emperor3((朱棣))--四子--&gt;emperor</span><br><span class="line">emperor4((朱高炽))--长子--&gt;emperor3</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="子图-subgraph"><a href="#子图-subgraph" class="headerlink" title="子图(subgraph)"></a>子图(subgraph)</h3><ul>
<li>需要将<code>graph</code>关键字改为<code>flowchart</code>，在代码段的开始加入<code>subgraph</code>，尾部加入<code>end</code></li>
</ul>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">        a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">        b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">        c1--&gt;c2</span><br><span class="line">    end</span><br><span class="line">    one --&gt; two</span><br><span class="line">    three --&gt; two</span><br><span class="line">    two --&gt; c2</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">        a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">        b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">        c1--&gt;c2</span><br><span class="line">    end</span><br><span class="line">    one --&gt; two</span><br><span class="line">    three --&gt; two</span><br><span class="line">    two --&gt; c2</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>注释：在行首加入<code>%%</code>即可。</li>
</ul>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    %%这是一条注释，在渲染图中不可见</span><br><span class="line">    A[Hard edge] --&gt;|Link text| B(Round edge)</span><br><span class="line">    B --&gt; C&#123;Decision&#125;</span><br><span class="line">    C --&gt;|One| D[Result one]</span><br><span class="line">    C --&gt;|Two| E[Result two]</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    %%这是一条注释，在渲染图中不可见</span><br><span class="line">    A[Hard edge] --&gt;|Link text| B(Round edge)</span><br><span class="line">    B --&gt; C&#123;Decision&#125;</span><br><span class="line">    C --&gt;|One| D[Result one]</span><br><span class="line">    C --&gt;|Two| E[Result two]</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="序列图-sequenceDiagram"><a href="#序列图-sequenceDiagram" class="headerlink" title="序列图(sequenceDiagram)"></a>序列图(sequenceDiagram)</h2><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    title: hello</span><br><span class="line">    autonumber</span><br><span class="line">    participant B as Browser</span><br><span class="line">    participant C as Controller</span><br><span class="line">    participant M as Model</span><br><span class="line">    participant V as View</span><br><span class="line">    note left of C: 左note</span><br><span class="line">    note right of C: 右note</span><br><span class="line">    note over B, C: 共note</span><br><span class="line">    B -&gt; C: 实线</span><br><span class="line">    activate C</span><br><span class="line">    C -&gt;&gt; B: 箭头实线</span><br><span class="line">    deactivate C</span><br><span class="line">    %%加号等价于activate M,减号等价于deactivate M</span><br><span class="line">    C --&gt;+ M: 虚线</span><br><span class="line">    M -x+ V: 打叉箭头实线</span><br><span class="line">    V --x- M: 打叉箭头虚线</span><br><span class="line">    M --&gt;&gt;- C: 箭头虚线</span><br><span class="line">    %% 循环</span><br><span class="line">    loop 每5分钟</span><br><span class="line">        %% Highlight background</span><br><span class="line">        rect rgba(0, 0, 255, 0.1)</span><br><span class="line">            V -&gt;&gt; V: 自环</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    loop 每5分钟</span><br><span class="line">        B--&gt;&gt;C:汇报</span><br><span class="line">    end</span><br><span class="line">    %% 可选条件</span><br><span class="line">    opt 心情好</span><br><span class="line">        M--&gt;&gt;V:唱歌</span><br><span class="line">    end</span><br><span class="line">    %% 条件判断</span><br><span class="line">    alt Controller没睡</span><br><span class="line">        B--&gt;&gt;C:吃宵夜吗</span><br><span class="line">    else Model没睡</span><br><span class="line">        B--&gt;&gt;M:吃宵夜吗</span><br><span class="line">    end</span><br><span class="line">    %% 并行发送</span><br><span class="line">    par Controller to Model</span><br><span class="line">        C--&gt;&gt;+M:hello?</span><br><span class="line">    and Controller to View</span><br><span class="line">        C--&gt;&gt;+V:hello?</span><br><span class="line">    end</span><br><span class="line">    %% 并行接收</span><br><span class="line">    par Model to Controller</span><br><span class="line">        M--&gt;&gt;-C:hi!</span><br><span class="line">    and Model to Controller</span><br><span class="line">        V--&gt;&gt;-C:hi!</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    title: hello</span><br><span class="line">    autonumber</span><br><span class="line">    participant B as Browser</span><br><span class="line">    participant C as Controller</span><br><span class="line">    participant M as Model</span><br><span class="line">    participant V as View</span><br><span class="line">    note left of C: 左note</span><br><span class="line">    note right of C: 右note</span><br><span class="line">    note over B, C: 共note</span><br><span class="line">    B -&gt; C: 实线</span><br><span class="line">    activate C</span><br><span class="line">    C -&gt;&gt; B: 箭头实线</span><br><span class="line">    deactivate C</span><br><span class="line">    %%加号等价于activate M,减号等价于deactivate M</span><br><span class="line">    C --&gt;+ M: 虚线</span><br><span class="line">    M -x+ V: 打叉箭头实线</span><br><span class="line">    V --x- M: 打叉箭头虚线</span><br><span class="line">    M --&gt;&gt;- C: 箭头虚线</span><br><span class="line">    %% 循环</span><br><span class="line">    loop 每5分钟</span><br><span class="line">        %% Highlight background</span><br><span class="line">        rect rgba(0, 0, 255, 0.1)</span><br><span class="line">            V -&gt;&gt; V: 自环</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    loop 每5分钟</span><br><span class="line">        B--&gt;&gt;C:汇报</span><br><span class="line">    end</span><br><span class="line">    %% 可选条件</span><br><span class="line">    opt 心情好</span><br><span class="line">        M--&gt;&gt;V:唱歌</span><br><span class="line">    end</span><br><span class="line">    %% 条件判断</span><br><span class="line">    alt Controller没睡</span><br><span class="line">        B--&gt;&gt;C:吃宵夜吗</span><br><span class="line">    else Model没睡</span><br><span class="line">        B--&gt;&gt;M:吃宵夜吗</span><br><span class="line">    end</span><br><span class="line">    %% 并行发送</span><br><span class="line">    par Controller to Model</span><br><span class="line">        C--&gt;&gt;+M:hello?</span><br><span class="line">    and Controller to View</span><br><span class="line">        C--&gt;&gt;+V:hello?</span><br><span class="line">    end</span><br><span class="line">    %% 并行接收</span><br><span class="line">    par Model to Controller</span><br><span class="line">        M--&gt;&gt;-C:hi!</span><br><span class="line">    and Model to Controller</span><br><span class="line">        V--&gt;&gt;-C:hi!</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>
<hr>
<pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    actor Z as 张三</span><br><span class="line">    actor L as 李四</span><br><span class="line">    Z -&gt;&gt; L: 实线箭头</span><br><span class="line">    Z -) L: 实线开放箭头</span><br></pre></td></tr></table></figure>
</pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    actor Z as 张三</span><br><span class="line">    actor L as 李四</span><br><span class="line">    Z -&gt;&gt; L: 实线箭头</span><br><span class="line">    Z -) L: 实线开放箭头</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="甘特图-gantt"><a href="#甘特图-gantt" class="headerlink" title="甘特图(gantt)"></a>甘特图(gantt)</h2><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gantt</span><br><span class="line">    title 研发周期</span><br><span class="line">    dateFormat  YYYY-MM-DD</span><br><span class="line">    section 项目</span><br><span class="line">        A 项目:  A1, 2022-01-01, 30d</span><br><span class="line">        B 项目:  after A1  , 20d</span><br><span class="line">    section 子任务</span><br><span class="line">        子任务1: 2022-01-12  , 12d</span><br><span class="line">        子任务2: 24d</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gantt</span><br><span class="line">    title 研发周期</span><br><span class="line">    dateFormat  YYYY-MM-DD</span><br><span class="line">    section 项目</span><br><span class="line">        A 项目:  A1, 2022-01-01, 30d</span><br><span class="line">        B 项目:  after A1  , 20d</span><br><span class="line">    section 子任务</span><br><span class="line">        子任务1: 2022-01-12  , 12d</span><br><span class="line">        子任务2: 24d</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="类图-classDiagram"><a href="#类图-classDiagram" class="headerlink" title="类图(classDiagram)"></a>类图(classDiagram)</h2><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">      Animal &lt;|-- Duck</span><br><span class="line">      Animal &lt;|-- Fish</span><br><span class="line">      Animal &lt;|-- Zebra</span><br><span class="line">      Animal : +int age</span><br><span class="line">      Animal : +String gender</span><br><span class="line">      Animal: +isMammal()</span><br><span class="line">      Animal: +mate()</span><br><span class="line">      class Duck&#123;</span><br><span class="line">          +String beakColor</span><br><span class="line">          +swim()</span><br><span class="line">          +quack()</span><br><span class="line">      &#125;</span><br><span class="line">      class Fish&#123;</span><br><span class="line">          -int sizeInFeet</span><br><span class="line">          -canEat()</span><br><span class="line">      &#125;</span><br><span class="line">      class Zebra&#123;</span><br><span class="line">          +bool is_wild</span><br><span class="line">          +run()</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">      Animal &lt;|-- Duck</span><br><span class="line">      Animal &lt;|-- Fish</span><br><span class="line">      Animal &lt;|-- Zebra</span><br><span class="line">      Animal : +int age</span><br><span class="line">      Animal : +String gender</span><br><span class="line">      Animal: +isMammal()</span><br><span class="line">      Animal: +mate()</span><br><span class="line">      class Duck&#123;</span><br><span class="line">          +String beakColor</span><br><span class="line">          +swim()</span><br><span class="line">          +quack()</span><br><span class="line">      &#125;</span><br><span class="line">      class Fish&#123;</span><br><span class="line">          -int sizeInFeet</span><br><span class="line">          -canEat()</span><br><span class="line">      &#125;</span><br><span class="line">      class Zebra&#123;</span><br><span class="line">          +bool is_wild</span><br><span class="line">          +run()</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="状态图-stateDiagram"><a href="#状态图-stateDiagram" class="headerlink" title="状态图(stateDiagram)"></a>状态图(stateDiagram)</h2><pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">stateDiagram-v2</span><br><span class="line">    state &quot;状态1&quot; as State1</span><br><span class="line">    State2 : 状态2</span><br><span class="line">    [*] --&gt; State1</span><br><span class="line">    State1 --&gt; State2: 过渡文本</span><br><span class="line">    State2 --&gt; State1</span><br><span class="line">    State2 --&gt; State3</span><br><span class="line">    state State3 &#123;</span><br><span class="line">        [*] --&gt; second</span><br><span class="line">        second --&gt; [*]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</pre>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stateDiagram-v2</span><br><span class="line">    state &quot;状态1&quot; as State1</span><br><span class="line">    State2 : 状态2</span><br><span class="line">    [*] --&gt; State1</span><br><span class="line"></span><br><span class="line">    State1 --&gt; State2: 过渡文本</span><br><span class="line">    State2 --&gt; State1</span><br><span class="line">    State2 --&gt; State3</span><br><span class="line">    state State3 &#123;</span><br><span class="line">        [*] --&gt; second</span><br><span class="line">        second --&gt; [*]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="用户旅程图-journey"><a href="#用户旅程图-journey" class="headerlink" title="用户旅程图(journey)"></a>用户旅程图(journey)</h2>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/05/06/linux%E7%BD%91%E7%BB%9C6_VLAN/">linux网络6_VLAN</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-05-06T07:32:41.000Z" itemprop="datePublished">2022-05-06</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/VLAN/" rel="tag">VLAN</a>, <a class="article-tag-link" href="/tags/linux/" rel="tag">linux</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h2><h3 id="什么是-VLAN"><a href="#什么是-VLAN" class="headerlink" title="什么是 VLAN"></a>什么是 VLAN</h3><p>VLAN （ Virtual Local Area Network ）又称虚拟局域网，是指在交换局域网的基础上，采用网络管理软件构建的可跨越不同网段、不同网络的端到端的逻辑网络。一个 VLAN 组成 一个逻辑子网， 即一个逻辑广播域，它可以覆盖多个网络设备，允许处于不同地理位置的网 络用户加入到一个逻辑子网中。</p>
<h3 id="使用-VLAN-优点"><a href="#使用-VLAN-优点" class="headerlink" title="使用 VLAN 优点"></a>使用 VLAN 优点</h3><ol>
<li><p>控制广播风暴</p>
<p> 一个 VLAN 就是一个逻辑广播域，通过对VLAN的创建，隔离了广播，缩小了广播范围，可以控制广播风暴的产生。</p>
</li>
<li><p>提高网络整体安全性</p>
<p> 通过路由访问列表和 MAC 地址分配等VLAN划分原则，可以控制用户访问权限和逻辑网段大小，将不同用户群划分在不同VLAN从而提高交换式网络的整体性能和安全性。</p>
</li>
<li><p>网络管理简单、直观</p>
<p> 对于交换式以太网， 如果对某些用户重新进行网段分配， 需要网络管理员对网络系统的 物理结构重新进行调整，甚至需要追加网络设备，增大网络管理的工作量。而对于采用VLAN 技术的网络来说，一个 VLAN 可以根据部门职能、对象组或者应用将不同地理位置的网络用 户划分为一个逻辑网段。在不改动网络物理连接的情况下可以任意地将工作站在工作组或子 网之间移动。利用虚拟网络技术，大大减轻了网络管理和维护工作的负担，降低了网络维护 费用。在一个交换网络中，VLAN 提供了网段和机构的弹性组合机制</p>
</li>
</ol>
<h3 id="物理网卡、子网卡、虚拟-VLAN-网卡的关系："><a href="#物理网卡、子网卡、虚拟-VLAN-网卡的关系：" class="headerlink" title="物理网卡、子网卡、虚拟 VLAN 网卡的关系："></a>物理网卡、子网卡、虚拟 VLAN 网卡的关系：</h3><ol>
<li>物理网卡：服务器上物理网络接口设备，也就是要配置 trunk 的具体接口。</li>
<li>子网卡：子网卡并不是网络接口设备，但是可以作为网络接口在系统中出现，如 eth0:1 、 eth1:2 这种网络接口。必须要依赖于物理网卡，可以与物理网卡同时在系统中存 在并使用不同的 IP 地址，而且也拥有它们自己的网络接口配置文件。但是所依赖的物理网 卡 down 掉时子网卡也不能工作。</li>
<li>虚拟 VLAN 网卡：虚拟 VLAN 网卡也不是物理网络接口设备，可以作为网络接口在系统 中出现，与子网卡不同的是，没有自己的配置文件。是通过将物理网加入不同的 VLAN 而生 成的 VLAN 虚拟网卡。如果将一个物理网卡添加到多个 VLAN 当中去的话，就会有多个 VLAN 虚拟网卡出现，相关的 VLAN 信息都是保存在/proc/net/vlan/config 这文件中的， 以 eth0.1、eth1.2 命名</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@li]<span class="comment"># modinfo 8021q # 查看是否有 vlan 模块</span></span><br><span class="line">[root@li]<span class="comment"># modprobe 8021q # 添加模块</span></span><br><span class="line">[root@li]<span class="comment"># vconfig add eth0 10 # 给eth0添加vlan id 10</span></span><br><span class="line">[root@li]<span class="comment"># vconfig add eth0 20 # 给eth0添加vlan id 20</span></span><br><span class="line">[root@li]<span class="comment"># vconfig set_flag eth0.10 1 1 # 设置VLAN的REORDER_HDR参数，默认就行了。</span></span><br><span class="line">[root@li]<span class="comment"># vconfig set_flag eth0.20 1 1 # 同上</span></span><br><span class="line">[root@TSG-li]<span class="comment"># cat /proc/net/vlan/eth0.10 # 查看eth0.10参数</span></span><br><span class="line">eth0.10 VID: 10 REORDER_HDR: 1 dev-&gt;priv_flags: 81</span><br><span class="line">    total frames received 1</span><br><span class="line">    total bytes received 68</span><br><span class="line">    Broadcast/Multicast Rcvd 1</span><br><span class="line">    total frames transmitted 3</span><br><span class="line">    total bytes transmitted 270</span><br><span class="line">    total headroom inc 0</span><br><span class="line">    total encap on xmit 3</span><br><span class="line">Device: eth0</span><br><span class="line">INGRESS priority mappings: 0:0 1:0 2:0 3:0 4:0 5:0 6:0 7:0</span><br><span class="line"> EGRESS priority Mappings:</span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0 0.0.0.0</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0.10 192.168.10.10 netmask 255.255.255.0 up</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0.20 192.168.20.10 netmask 255.255.255.0 up</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0.10</span></span><br><span class="line">eth0.10 Link encap:Ethernet HWaddr 00:0C:29:27:D6:74</span><br><span class="line"> inet addr:192.168.10.10 Bcast:192.168.10.255 Mask:255.255.255.0</span><br><span class="line"> inet6 addr: fe80::20c:29ff:fe27:d674/64 Scope:Link</span><br><span class="line"> UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line"> RX packets:1 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line"> TX packets:3 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line"> collisions:0 txqueuelen:0</span><br><span class="line"> RX bytes:68 (68.0 b) TX bytes:270 (270.0 b)</span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0.20</span></span><br><span class="line">eth0.20 Link encap:Ethernet HWaddr 00:0C:29:27:D6:74</span><br><span class="line"> inet addr:192.168.20.10 Bcast:192.168.20.255 Mask:255.255.255.0</span><br><span class="line"> inet6 addr: fe80::20c:29ff:fe27:d674/64 Scope:Link</span><br><span class="line"> UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line"> RX packets:1 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line"> TX packets:2 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line"> collisions:0 txqueuelen:0</span><br><span class="line"> RX bytes:68 (68.0 b) TX bytes:176 (176.0 b)</span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># brctl addbr br0 # 创建一个网桥</span></span><br><span class="line">[root@li]<span class="comment"># brctl show</span></span><br><span class="line">[root@li]<span class="comment"># brctl addif br0 eth0.10 # 把vlan eth0.10加到网桥上</span></span><br><span class="line">[root@li]<span class="comment"># brctl addif br0 eth0.20 # 把vlan eth0.20加到网桥上</span></span><br><span class="line">[root@li]<span class="comment"># brctl show</span></span><br><span class="line"></span><br><span class="line">bridge name bridge id           STP enabled interfaces</span><br><span class="line">br0         8000.000c29f59487   no          eth0.10,eth0.20</span><br><span class="line"></span><br><span class="line"><span class="comment">#STP enabled为no，可以用brctl stp &lt;bridge&gt; &lt;state&gt; 控制网桥是否加入STP树中，&lt;state&gt;可以是&#x27;on&#x27;或者&#x27;yes&#x27;表示加入stp树中，&#x27;off&#x27;表示关闭stp。</span></span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># brctl stp br0 yes</span></span><br><span class="line">[root@li]<span class="comment"># brctl show</span></span><br><span class="line">bridge name bridge id           STP enabled interfaces</span><br><span class="line">br0         8000.000c29f59487   yes         eth0.10,eth0.20</span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># brctl stp br0 off</span></span><br><span class="line">[root@li]<span class="comment"># brctl show</span></span><br><span class="line">bridge name bridge id           STP enabled interfaces</span><br><span class="line">br0         8000.000c29f59487   no          eth0.10,eth0.20</span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># ifconfig br0 172.16.1.254/24 # 配置网桥br0的ip # ip a a 172.16.1.254/24 dev br0</span></span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth0.10 down</span></span><br><span class="line">[root@li]<span class="comment"># ip link set eth0.10 name eth10 # 改eth0.10网卡名称</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth10 up</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig eth10</span></span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># brctl showmacs br0 #查看Mac地址和接口的对应关系，即MAC表，思科交换机设备叫CAM表</span></span><br><span class="line"></span><br><span class="line">[root@li]<span class="comment"># vconfig rem eth0.10 #删除vlan</span></span><br><span class="line">[root@li]<span class="comment"># vconfig rem eth0.20</span></span><br><span class="line">[root@li]<span class="comment"># ifconfig br0 down</span></span><br><span class="line">[root@li]<span class="comment"># brctl delbr br0 #删除网桥</span></span><br></pre></td></tr></table></figure>
<h2 id="brctl"><a href="#brctl" class="headerlink" title="brctl"></a>brctl</h2><p>有五台主机。其中一台主机装有linux ，安装了网桥模块，而且有四块物理网卡，分别连接同一网段的其他主机。我们希望其成为一个网桥，为其他四台主机(IP分别为192.168.1.2 ，192.168.1.3，192.168.1.4，192.168.1.5) 之间转发数据包。同时，为了方便管理，希望网桥能够有一个IP（192.168.1.1），那样管理员就可以在192.168.1.0/24网段内的主机上telnet到网桥，对其进行配置，实现远程管理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brctl addbr br0 <span class="comment">#建立一个逻辑网段，名称为br0</span></span><br></pre></td></tr></table></figure>
<p>建立一个逻辑网段之后，我们还需要为这个网段分配特定的端口。在Linux中，一个端口实际上就是一个物理网卡。而每个物理网卡的名称则分别为eth0，eth1，eth2，eth3。我们需要把每个网卡一一和br0这个网段联系起来，作为br0中的一个端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brctl addif br0 eth0 <span class="comment">#让eth0成为br0的一个端口</span></span><br><span class="line">brctl addif br0 eth1 <span class="comment">#同上</span></span><br><span class="line">brctl addif br0 eth2 <span class="comment">#同上</span></span><br><span class="line">brctl addif br0 eth3 <span class="comment">#同上</span></span><br></pre></td></tr></table></figure>
<p>网桥的每个物理网卡作为一个端口，运行于混杂模式，而且是在链路层工作，所以就不需要IP了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 0.0.0.0</span><br><span class="line">ifconfig eth1 0.0.0.0</span><br><span class="line">ifconfig eth2 0.0.0.0</span><br><span class="line">ifconfig eth3 0.0.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig br0 192.168.1.1 <span class="comment">#给br0的虚拟网卡配置IP，那样就能远程管理网桥。</span></span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/05/05/quilt%E7%AC%94%E8%AE%B0/">quilt笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-05-05T07:32:41.000Z" itemprop="datePublished">2022-05-05</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/quilt/" rel="tag">quilt</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="quilt"><a href="#quilt" class="headerlink" title="quilt"></a>quilt</h2><h3 id="使用例子"><a href="#使用例子" class="headerlink" title="使用例子"></a>使用例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:08:57]</span></span><br><span class="line">$ ls</span><br><span class="line">main.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:08:58]</span></span><br><span class="line">$ cat main.c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main(int argv,char **argc) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:09:04]</span></span><br><span class="line">$ quilt new 0000-add_patched_first_line.patch      <span class="comment"># 创建一个patch</span></span><br><span class="line">Patch patches/0000-add_patched_first_line.patch is now on top</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:09:05]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── main.c</span><br><span class="line">└── patches</span><br><span class="line">    └── series</span><br><span class="line"></span><br><span class="line">1 directory, 2 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:09:16]</span></span><br><span class="line">$ quilt add main.c   <span class="comment"># 添加追踪文件</span></span><br><span class="line">File main.c added to patch patches/0000-add_patched_first_line.patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:09:18]</span></span><br><span class="line">$ quilt edit main.c  <span class="comment"># 修改代码</span></span><br><span class="line">File main.c is already <span class="keyword">in</span> patch patches/0000-add_patched_first_line.patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:09:52]</span></span><br><span class="line">$ quilt diff  <span class="comment"># 查看代码改动内容</span></span><br><span class="line">Index: hello/main.c</span><br><span class="line">===================================================================</span><br><span class="line">--- hello.orig/main.c</span><br><span class="line">+++ hello/main.c</span><br><span class="line">@@ -1,5 +1,6 @@</span><br><span class="line"> <span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"> int main(int argv,char **argc) &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">+    <span class="built_in">printf</span>(<span class="string">&quot;I am the first patched line\n&quot;</span>);</span><br><span class="line">     <span class="built_in">return</span> 0;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:10:03]</span></span><br><span class="line">$ quilt refresh -pab  <span class="comment"># 把代码改动保存到patch文件</span></span><br><span class="line">Refreshed patch patches/0000-add_patched_first_line.patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:10:08]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── main.c</span><br><span class="line">└── patches</span><br><span class="line">    ├── 0000-add_patched_first_line.patch</span><br><span class="line">    └── series</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:11:18]</span></span><br><span class="line">$ quilt new 0001-add_patched_second_line.patch <span class="comment"># 创建第2个patch(建议先用quilt push -a应用所有已存在的patch，然后再执行这个)</span></span><br><span class="line">Patch patches/0001-add_patched_second_line.patch is now on top</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:11:49]</span></span><br><span class="line">$ quilt edit main.c</span><br><span class="line">File main.c added to patch patches/0001-add_patched_second_line.patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:11:56]</span></span><br><span class="line">$ quilt diff</span><br><span class="line">Index: hello/main.c</span><br><span class="line">===================================================================</span><br><span class="line">--- hello.orig/main.c</span><br><span class="line">+++ hello/main.c</span><br><span class="line">@@ -2,5 +2,6 @@</span><br><span class="line"> int main(int argv,char **argc) &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;I am the first patched line\n&quot;</span>);</span><br><span class="line">+    <span class="built_in">printf</span>(<span class="string">&quot;I am the second patched line\n&quot;</span>);</span><br><span class="line">     <span class="built_in">return</span> 0;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:12:07]</span></span><br><span class="line">$ quilt refresh -pab</span><br><span class="line">Refreshed patch patches/0001-add_patched_second_line.patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:12:09]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── main.c</span><br><span class="line">└── patches</span><br><span class="line">    ├── 0000-add_patched_first_line.patch</span><br><span class="line">    ├── 0001-add_patched_second_line.patch</span><br><span class="line">    └── series</span><br><span class="line"></span><br><span class="line">1 directory, 4 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [15:12:15]</span></span><br><span class="line">$ quilt series  <span class="comment"># 查看全部patch</span></span><br><span class="line">patches/0000-add_patched_first_line.patch</span><br><span class="line">patches/0001-add_patched_second_line.patch</span><br></pre></td></tr></table></figure>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><p>quilt配置<code>~/.quiltrc</code>或者<code>/etc/quilt.quiltrc</code>，可以打开<code>/usr/bin/quilt</code>来看看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ~/.quiltrc &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">QUILT_DIFF_ARGS=&quot;--no-timestamps --no-index -p ab --color=auto&quot;</span></span><br><span class="line"><span class="string">QUILT_REFRESH_ARGS=&quot;--no-timestamps --no-index -p ab&quot;</span></span><br><span class="line"><span class="string">QUILT_SERIES_ARGS=&quot;--color=auto&quot;</span></span><br><span class="line"><span class="string">QUILT_PATCH_OPTS=&quot;--unified&quot;</span></span><br><span class="line"><span class="string">QUILT_DIFF_OPTS=&quot;-p&quot;</span></span><br><span class="line"><span class="string">EDITOR=&quot;vim&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>前面几个都是对脚本里面使用diff，patch这些工具时，所使用的参数进行配置，EDITOR这项配置为自己习惯的编辑器</p>
<p>补丁名字以数字开头，然后通过<code>-</code>符号链接一个简短的描述，其中数字的大小就是最终打补丁的顺序</p>
<p><code>quilt files</code>:查看被追踪的文件</p>
<p><code>quilt edit main.c</code>:添加追踪并编辑，也可以<code>quilt add main.c</code>之后直接用其他编辑器编辑</p>
<p><code>quilt top</code>:查看最近的补丁（最后一个）（初始为空）</p>
<p><code>quilt push</code>:应用补丁（压栈）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quilt push -a <span class="comment">#应用所有</span></span><br><span class="line">quilt push 010-xxx.patch <span class="comment">#应用从000-&gt;010所有的补丁</span></span><br><span class="line">quilt push <span class="comment">#应用单个补丁</span></span><br></pre></td></tr></table></figure>
<p><code>quilt pop</code>:取消应用（弹栈）（回滚）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quilt pop -a  <span class="comment">#取消所有</span></span><br><span class="line">quilt pop 002-yyy.patch  <span class="comment">#取消到指定指定补丁处（当前-&gt;002）</span></span><br><span class="line">quilt pop <span class="comment">#取消单个</span></span><br></pre></td></tr></table></figure>
<p><code>quilt edit main.c</code>:修改，开发</p>
<p><code>quilt diff</code>:查看修改（当前补丁）</p>
<p><code>quilt refresh</code>:保存为patch</p>
<p><code>quilt files</code>:查看当前补丁中已修改文件</p>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/04/11/cmake%E7%AC%94%E8%AE%B0/">cmake笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-04-11T08:32:41.000Z" itemprop="datePublished">2022-04-11</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/cmake/" rel="tag">cmake</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h2><h3 id="project"><a href="#project" class="headerlink" title="project()"></a>project()</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/tmp/hello [22:45:26]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── subhello</span><br><span class="line">    └── CMakeLists.txt</span><br><span class="line"></span><br><span class="line">1 directory, 2 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/tmp/hello [22:45:27]</span></span><br><span class="line">$ cat CMakeLists.txt</span><br><span class="line">cmake_minimum_required(VERSION 3.9)</span><br><span class="line">project(hello VERSION 0.1.2.3 DESCRIPTION <span class="string">&quot;an hello program&quot;</span> LANGUAGES C HOMEPAGE_URL “https://www.hello.com”)</span><br><span class="line"></span><br><span class="line">add_subdirectory(subhello)</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/tmp/hello [22:45:34]</span></span><br><span class="line">$ cat subhello/CMakeLists.txt</span><br><span class="line">cmake_minimum_required(VERSION 3.9)</span><br><span class="line">project(subhello VERSION 3.2.1.0 DESCRIPTION <span class="string">&quot;an subhello program&quot;</span> LANGUAGES C HOMEPAGE_URL “https://www.subhello.com”)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(<span class="built_in">print</span>)</span><br><span class="line">    foreach(var <span class="variable">$&#123;ARGN&#125;</span>)</span><br><span class="line">        message(<span class="string">&quot;<span class="variable">$&#123;var&#125;</span> = <span class="variable">$&#123;<span class="variable">$&#123;var&#125;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    endforeach()</span><br><span class="line">endfunction()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(</span><br><span class="line">    PROJECT_NAME       <span class="comment"># PROJECT_NAME = subhello    # 当前</span></span><br><span class="line">    CMAKE_PROJECT_NAME <span class="comment"># CMAKE_PROJECT_NAME = hello # 顶层</span></span><br><span class="line"></span><br><span class="line">    hello_SOURCE_DIR    <span class="comment"># hello_SOURCE_DIR = /home/zh/tmp/hello             # hello项目</span></span><br><span class="line">    subhello_SOURCE_DIR <span class="comment"># subhello_SOURCE_DIR = /home/zh/tmp/hello/subhello # subhello项目</span></span><br><span class="line">    PROJECT_SOURCE_DIR  <span class="comment"># PROJECT_SOURCE_DIR = /home/zh/tmp/hello/subhello  # 当前</span></span><br><span class="line">    CMAKE_SOURCE_DIR    <span class="comment"># CMAKE_SOURCE_DIR = /home/zh/tmp/hello             # 顶层</span></span><br><span class="line"></span><br><span class="line">    hello_BINARY_DIR    <span class="comment"># hello_BINARY_DIR = /home/zh/tmp/hello/build             # hello项目</span></span><br><span class="line">    subhello_BINARY_DIR <span class="comment"># subhello_BINARY_DIR = /home/zh/tmp/hello/build/subhello # subhello项目</span></span><br><span class="line">    PROJECT_BINARY_DIR  <span class="comment"># PROJECT_BINARY_DIR = /home/zh/tmp/hello/build/subhello  # 当前</span></span><br><span class="line">    CMAKE_BINARY_DIR    <span class="comment"># CMAKE_BINARY_DIR = /home/zh/tmp/hello/build             # 顶层</span></span><br><span class="line"></span><br><span class="line">    hello_VERSION         <span class="comment"># hello_VERSION = 0.1.2.3</span></span><br><span class="line">    subhello_VERSION      <span class="comment"># subhello_VERSION = 3.2.1.0</span></span><br><span class="line">    PROJECT_VERSION       <span class="comment"># PROJECT_VERSION = 3.2.1.0</span></span><br><span class="line">    CMAKE_PROJECT_VERSION <span class="comment"># CMAKE_PROJECT_VERSION = 0.1.2.3 #顶层</span></span><br><span class="line"></span><br><span class="line">    hello_VERSION_MAJOR         <span class="comment"># hello_VERSION_MAJOR = 0</span></span><br><span class="line">    subhello_VERSION_MAJOR      <span class="comment"># subhello_VERSION_MAJOR = 3</span></span><br><span class="line">    PROJECT_VERSION_MAJOR       <span class="comment"># PROJECT_VERSION_MAJOR = 3</span></span><br><span class="line">    CMAKE_PROJECT_VERSION_MAJOR <span class="comment"># PROJECT_VERSION_MAJOR = 0 #顶层</span></span><br><span class="line"></span><br><span class="line">    hello_VERSION_MINOR         <span class="comment"># hello_VERSION_MINOR = 1</span></span><br><span class="line">    subhello_VERSION_MINOR      <span class="comment"># subhello_VERSION_MINOR = 2</span></span><br><span class="line">    PROJECT_VERSION_MINOR       <span class="comment"># PROJECT_VERSION_MINOR = 2</span></span><br><span class="line">    CMAKE_PROJECT_VERSION_MINOR <span class="comment"># PROJECT_VERSION_MINOR = 1 #顶层</span></span><br><span class="line"></span><br><span class="line">    hello_VERSION_PATCH         <span class="comment"># hello_VERSION_PATCH = 2</span></span><br><span class="line">    subhello_VERSION_PATCH      <span class="comment"># subhello_VERSION_PATCH = 1</span></span><br><span class="line">    PROJECT_VERSION_PATCH       <span class="comment"># PROJECT_VERSION_PATCH = 1</span></span><br><span class="line">    CMAKE_PROJECT_VERSION_PATCH <span class="comment"># PROJECT_VERSION_PATCH = 2 #顶层</span></span><br><span class="line"></span><br><span class="line">    hello_VERSION_TWEAK         <span class="comment"># hello_VERSION_TWEAK = 3</span></span><br><span class="line">    subhello_VERSION_TWEAK      <span class="comment"># subhello_VERSION_TWEAK = 0</span></span><br><span class="line">    PROJECT_VERSION_TWEAK       <span class="comment"># PROJECT_VERSION_TWEAK = 0</span></span><br><span class="line">    CMAKE_PROJECT_VERSION_TWEAK <span class="comment"># PROJECT_VERSION_TWEAK = 3 #顶层</span></span><br><span class="line"></span><br><span class="line">    hello_DESCRIPTION         <span class="comment"># PROJECT_DESCRIPTION = an hello program</span></span><br><span class="line">    subhello_DESCRIPTION      <span class="comment"># PROJECT_DESCRIPTION = an subhello program</span></span><br><span class="line">    PROJECT_DESCRIPTION       <span class="comment"># PROJECT_DESCRIPTION = an subhello program</span></span><br><span class="line">    CMAKE_PROJECT_DESCRIPTION <span class="comment"># CMAKE_PROJECT_DESCRIPTION = an hello program # 顶层</span></span><br><span class="line"></span><br><span class="line">    hello_HOMEPAGE_URL         <span class="comment"># hello_HOMEPAGE_URL = “https://www.hello.com”</span></span><br><span class="line">    subhello_HOMEPAGE_URL      <span class="comment"># subhello_HOMEPAGE_URL = “https://www.subhello.com”</span></span><br><span class="line">    PROJECT_HOMEPAGE_URL       <span class="comment"># subhello_HOMEPAGE_URL = “https://www.subhello.com”</span></span><br><span class="line">    CMAKE_PROJECT_HOMEPAGE_URL <span class="comment"># hello_HOMEPAGE_URL = “https://www.hello.com” # 顶层</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="GNUInstallDirs"><a href="#GNUInstallDirs" class="headerlink" title="GNUInstallDirs"></a>GNUInstallDirs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [11:19:03]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">└── CMakeLists.txt</span><br><span class="line"></span><br><span class="line">0 directories, 1 file</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [11:19:04]</span></span><br><span class="line">$ cat CMakeLists.txt</span><br><span class="line">cmake_minimum_required(VERSION 3.9)</span><br><span class="line">project(hello VERSION 0.1.2.3 DESCRIPTION <span class="string">&quot;an hello program&quot;</span> LANGUAGES C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(<span class="built_in">print</span>)</span><br><span class="line">    foreach(var <span class="variable">$&#123;ARGN&#125;</span>)</span><br><span class="line">        message(<span class="string">&quot;<span class="variable">$&#123;var&#125;</span> # <span class="variable">$&#123;var&#125;</span> = <span class="variable">$&#123;<span class="variable">$&#123;var&#125;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    endforeach()</span><br><span class="line">endfunction()</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_INSTALL_PREFIX <span class="string">&quot;/usr&quot;</span>) <span class="comment"># 在include(GNUInstallDirs)前设置，否则就是默认/usr/local</span></span><br><span class="line">include(GNUInstallDirs)</span><br><span class="line"><span class="built_in">print</span>(</span><br><span class="line">    CMAKE_INSTALL_PREFIX <span class="comment"># CMAKE_INSTALL_PREFIX = /</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_BINDIR      <span class="comment"># CMAKE_INSTALL_BINDIR = usr/bin</span></span><br><span class="line">    CMAKE_INSTALL_FULL_BINDIR <span class="comment"># CMAKE_INSTALL_FULL_BINDIR = /usr/bin</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_SBINDIR      <span class="comment"># CMAKE_INSTALL_SBINDIR = usr/sbin</span></span><br><span class="line">    CMAKE_INSTALL_FULL_SBINDIR <span class="comment"># CMAKE_INSTALL_FULL_SBINDIR = /usr/sbin</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_LIBEXECDIR      <span class="comment"># CMAKE_INSTALL_LIBEXECDIR = usr/libexec</span></span><br><span class="line">    CMAKE_INSTALL_FULL_LIBEXECDIR <span class="comment"># CMAKE_INSTALL_FULL_LIBEXECDIR = /usr/libexec</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_SYSCONFDIR      <span class="comment"># CMAKE_INSTALL_SYSCONFDIR = etc</span></span><br><span class="line">    CMAKE_INSTALL_FULL_SYSCONFDIR <span class="comment"># CMAKE_INSTALL_FULL_SYSCONFDIR = /etc</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_SHAREDSTATEDIR      <span class="comment"># CMAKE_INSTALL_SHAREDSTATEDIR = usr/com</span></span><br><span class="line">    CMAKE_INSTALL_FULL_SHAREDSTATEDIR <span class="comment"># CMAKE_INSTALL_FULL_SHAREDSTATEDIR = /usr/com</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_LOCALSTATEDIR      <span class="comment"># CMAKE_INSTALL_LOCALSTATEDIR = var</span></span><br><span class="line">    CMAKE_INSTALL_FULL_LOCALSTATEDIR <span class="comment"># CMAKE_INSTALL_FULL_LOCALSTATEDIR = /var</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_RUNSTATEDIR      <span class="comment"># CMAKE_INSTALL_RUNSTATEDIR = var/run</span></span><br><span class="line">    CMAKE_INSTALL_FULL_RUNSTATEDIR <span class="comment"># CMAKE_INSTALL_FULL_RUNSTATEDIR = /var/run</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_LIBDIR      <span class="comment"># CMAKE_INSTALL_LIBDIR = usr/lib</span></span><br><span class="line">    CMAKE_INSTALL_FULL_LIBDIR <span class="comment"># CMAKE_INSTALL_FULL_LIBDIR = /usr/lib</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_INCLUDEDIR      <span class="comment"># CMAKE_INSTALL_INCLUDEDIR = usr/include</span></span><br><span class="line">    CMAKE_INSTALL_FULL_INCLUDEDIR <span class="comment"># CMAKE_INSTALL_FULL_INCLUDEDIR = /usr/include</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_OLDINCLUDEDIR      <span class="comment"># CMAKE_INSTALL_OLDINCLUDEDIR = /usr/include</span></span><br><span class="line">    CMAKE_INSTALL_FULL_OLDINCLUDEDIR <span class="comment"># CMAKE_INSTALL_FULL_OLDINCLUDEDIR = /usr/include</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_DATAROOTDIR      <span class="comment"># CMAKE_INSTALL_DATAROOTDIR = usr/share</span></span><br><span class="line">    CMAKE_INSTALL_FULL_DATAROOTDIR <span class="comment"># CMAKE_INSTALL_FULL_DATAROOTDIR = /usr/share</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_DATADIR      <span class="comment"># CMAKE_INSTALL_DATADIR = usr/share</span></span><br><span class="line">    CMAKE_INSTALL_FULL_DATADIR <span class="comment"># CMAKE_INSTALL_FULL_DATADIR = /usr/share</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_INFODIR      <span class="comment"># CMAKE_INSTALL_INFODIR = usr/share/info</span></span><br><span class="line">    CMAKE_INSTALL_FULL_INFODIR <span class="comment"># CMAKE_INSTALL_FULL_INFODIR = /usr/share/info</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_LOCALEDIR      <span class="comment"># CMAKE_INSTALL_LOCALEDIR = usr/share/locale</span></span><br><span class="line">    CMAKE_INSTALL_FULL_LOCALEDIR <span class="comment"># CMAKE_INSTALL_FULL_LOCALEDIR = /usr/share/locale</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_MANDIR      <span class="comment"># CMAKE_INSTALL_MANDIR = usr/share/man</span></span><br><span class="line">    CMAKE_INSTALL_FULL_MANDIR <span class="comment"># CMAKE_INSTALL_FULL_MANDIR = /usr/share/man</span></span><br><span class="line"></span><br><span class="line">    CMAKE_INSTALL_DOCDIR      <span class="comment"># CMAKE_INSTALL_DOCDIR = usr/share/doc/hello</span></span><br><span class="line">    CMAKE_INSTALL_FULL_DOCDIR <span class="comment"># CMAKE_INSTALL_FULL_DOCDIR = /usr/share/doc/hello</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h3 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_NAME Linux)</span><br><span class="line"><span class="keyword">set</span>(TOOLCHAIN_PATH /OPT/gcc-arm-linux-gnueabi)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER <span class="variable">$&#123;tools&#125;</span>/bin/arm-linux-gnueabi-gcc)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER <span class="variable">$&#123;tools&#125;</span>/bin/arm-linux-gnueabi-g++)</span><br></pre></td></tr></table></figure>
<p><code>set(CMAKE_SYSTEM_NAME Linux)</code>该指令必须存在，其目的是设置目标机使用的操作系统名称，支持Linux，QNX，WindowsCE，Android等。如果没有操作系统，那么就写 Generic。执行该指令后，cmake 变量——<code>CMAKE_CROSSCOMPILING</code> 会自动被设置为 <code>TRUE</code>，此时 cmake 就会“知道“现在执行的是交叉编译；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [19:44:35]</span></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── cmake</span><br><span class="line">│   └── toolchain_x86.cmake</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── src</span><br><span class="line">    └── main.c</span><br><span class="line"></span><br><span class="line">2 directories, 3 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [19:44:38]</span></span><br><span class="line">$ cat cmake/toolchain_x86.cmake</span><br><span class="line"><span class="built_in">set</span>(CMAKE_SYSTEM_NAME Linux)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(TOOLCHAIN_PATH /usr/bin)</span><br><span class="line"><span class="built_in">set</span>(CMAKE_C_COMPILER gcc)</span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_COMPILER g++)</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [19:44:41]</span></span><br><span class="line">$ cat CMakeLists.txt</span><br><span class="line">cmake_minimum_required(VERSION 3.9)</span><br><span class="line">project(hello VERSION 0.1.2.3 DESCRIPTION <span class="string">&quot;an hello program&quot;</span> LANGUAGES C)</span><br><span class="line"></span><br><span class="line">FILE(GLOB SRC_FILES <span class="string">&quot;src/*.c&quot;</span>)</span><br><span class="line"></span><br><span class="line">add_executable(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;SRC_FILES&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [19:44:43]</span></span><br><span class="line">$ cat src/main.c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line">int main(int argc, char **argv) &#123; <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>); <span class="built_in">return</span> 0; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [19:44:46]</span></span><br><span class="line">$ mkdir build &amp;&amp; <span class="built_in">cd</span> build &amp;&amp; cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain_x86.cmake ..</span><br><span class="line">-- The C compiler identification is GNU 11.2.0</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - <span class="keyword">done</span></span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/gcc - skipped</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - <span class="keyword">done</span></span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /home/zh/li/tmp/hello/build</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello/build [19:44:53]</span></span><br><span class="line">$ make</span><br><span class="line">[ 50%] Building C object CMakeFiles/hello.dir/src/main.c.o</span><br><span class="line">[100%] Linking C executable hello</span><br><span class="line">[100%] Built target hello</span><br></pre></td></tr></table></figure>
<p>注意：<code>-DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain_x86.cmake</code> 不能直接写入<code>CMakeLists.txt</code>或<code>include(toolchain_x86.cmake)</code></p>
<p>需要链接系统库或第三方库时，cmake 提供了<code>FIND_PROGRAM()</code>，<code>FIND_LIBRARY()</code>， <code>FIND_FILE()</code>， <code>FIND_PATH()</code> 和 <code>FIND_PACKAGE()</code> 来查找库路径或包。默认情况下，上述指令查找的是主机上的文件，其并不适用于目标机器。为此cmake提供了相应的变量：</p>
<p><code>set(CMAKE_FIND_ROOT_PATH path1 path2 path3 ...)</code>：设置其值为多个目录，这样 <code>FIND_XXX()</code> 就会从这些目录中查找。</p>
<p>跟随该变量的有下述 3 个变量，它们的值为 <code>NEVER</code> 、 <code>ONLY</code> 或 <code>BOTH</code>：</p>
<p><code>CMAKE_FIND_ROOT_PATH_MODE_PROGRAM</code>若设为</p>
<ul>
<li><code>NEVER</code>，则<code>FIND_PROGRAM()</code> 不会在 <code>CMAKE_FIND_ROOT_PATH</code> 指定的目录中寻找</li>
<li><code>ONLY</code>，则<code>FIND_PROGRAM()</code> 只会从 <code>CMAKE_FIND_ROOT_PATH</code> 指定的目录中寻找</li>
<li><code>BOTH</code>，则<code>FIND_PROGRAM()</code> 会优先从 <code>CMAKE_FIND_ROOT_PATH</code> 指定的目录中寻找，再从默认的目录中寻找</li>
</ul>
<p><code>FIND_PROGRAM()</code> 通常用于寻找可执行程序，给后续的 <code>EXECUTE_PROCESS()</code> 或 <code>ADD_CUSTOM_COMMAND()</code> 指令使用。并且，只有主机在生成编译文件时使用该可执行程序。因此通常设置 <code>set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)</code></p>
<p><code>CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</code>：交叉编译只能使用 <code>FIND_LIBRARY()</code> 查找符合目标机器的库文件，因此设置<code>set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)</code></p>
<p><code>CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</code>：同上，设为 <code>ONLY</code>。</p>
<h3 id="编译选项"><a href="#编译选项" class="headerlink" title="编译选项"></a>编译选项</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_definitions</span>(-std=c++<span class="number">11</span>)</span><br><span class="line"><span class="keyword">SET</span>(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb -Wl,-rpath=./:./lib&quot;</span>) <span class="comment">#-Wl,-rpath=./</span></span><br><span class="line"><span class="keyword">SET</span>(CMAKE_CXX_FLAGS_RELEASE <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O3 -Wl,-rpath=./:./lib&quot;</span>) <span class="comment">#-Wall</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_PREFIX_PATH=/path/to -DCMAKE_LIBRARY_PATH=/path/to -DCMAKE_CXX_FLAGS=-m32 -DCMAKE_C_FLAGS=-m32</span><br></pre></td></tr></table></figure>
<h3 id="find-xxx"><a href="#find-xxx" class="headerlink" title="find_xxx()"></a>find_xxx()</h3><ol>
<li><code>set(CMAKE_PREFIX_PATH &quot;/path/libs/xxx-install&quot;)</code>之后，<code>pkg_search_module()</code>就能去<code>/path/libs/xxx-install</code>找到库的<code>libxxx.pc</code>文件</li>
<li><code>set(ENV&#123;PKG_CONFIG_PATH&#125; &quot;$ENV&#123;PKG_CONFIG_PATH&#125;:/my/path/to/pkgconfig&quot;)</code>之后，也能找找到<code>libxxx.pc</code></li>
</ol>
<h3 id="pkg-search-module"><a href="#pkg-search-module" class="headerlink" title="pkg_search_module()"></a>pkg_search_module()</h3><p>旧版本: <code>pkg_search_module(PKG_XXX REQUIRED xxx)</code>生成3个变量</p>
<ul>
<li><code>PKG_XXX_INCLUDE_DIRS</code>:编译时xxx库提供的头文件目录</li>
<li><code>PKG_XXX_LIBRARIES</code>:只提供xxx库的名字，不提供路径</li>
<li><code>PKG_XXX_LDFLAGS</code>:包含xxx的路径和库</li>
</ul>
<p>你可以：<code>target_link_libraries(my_proj $&#123;PKG_XXX_LDFLAGS&#125;)</code></p>
<p>新版本: <code>pkg_search_module(PKG_XXX REQUIRED IMPORTED_TARGET opencv)</code>里面的<code>IMPORTED_TARGET</code>会创建一个供你直接在项目中使用的目标<br>你可以: <code>target_link_libraries(my_proj PRIVATE PkgConfig::PKG_XXX)</code></p>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/04/11/iperf3%E7%AC%94%E8%AE%B0/">iperf笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-04-11T07:32:41.000Z" itemprop="datePublished">2022-04-11</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/iperf/" rel="tag">iperf</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="iperf"><a href="#iperf" class="headerlink" title="iperf"></a>iperf</h2><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iperf3 -s  <span class="comment">#-s 表示以服务器方式启动</span></span><br><span class="line"><span class="comment">#-B 表示监听指定 IP地址， 0.0.0.0 表示监听 本地IP 和 局域网(公网)IP</span></span><br><span class="line"><span class="comment">#-p 表示监听指定 端口，上述我们指定监听的端口号是 5207 ，没有该参数时，默认端口号是 5201</span></span><br><span class="line">iperf3 -s -B 0.0.0.0 -p 5207</span><br></pre></td></tr></table></figure>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iperf3 -c 192.168.198.39    <span class="comment"># -c 表示以客户端方式启动 iperf</span></span><br><span class="line">iperf3 -c 192.168.198.39 -R <span class="comment"># -R 用相反的模式运行，服务端发送，客户端接收</span></span><br><span class="line"><span class="comment">#-u 表示用 udp 连接来测速，默认是 tcp 连接测试，因为 tcp 要进行确认，所以不如 udp 测试的准确</span></span><br><span class="line"><span class="comment">#-b 目标带宽，UDP模式使用的带宽，单位b/s，0表示无限制，此选项与 -u 选项相关，默认值是1 Mb/s，1g 表示估计能跑 1Gbps</span></span><br><span class="line"><span class="comment">#-t 表示持续测试时间，10 表示测试 10s</span></span><br><span class="line"><span class="comment">#-i 表示多少秒输出一次测试结果，1 表示 1s 刷新一次</span></span><br><span class="line"><span class="comment">#-p 表示测试服务器端口，5207是测速服务器的端口</span></span><br><span class="line">iperf3 -c 192.168.3.83 -b 1g -t 10 -i 1 -u -p 5207</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/03/22/vscode%E7%AC%94%E8%AE%B0/">vscose笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-03-22T07:32:41.000Z" itemprop="datePublished">2022-03-22</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/vscode/" rel="tag">vscode</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="vscode配置"><a href="#vscode配置" class="headerlink" title="vscode配置"></a>vscode配置</h2><p>vscode插件<code>vim</code>:esc和caps没切换，文件-首选项-设置，搜<code>Keyboard:Dispatch</code>改为<code>keyCode</code>重启软件即可</p>
<h2 id="vscode调试C-C"><a href="#vscode调试C-C" class="headerlink" title="vscode调试C/C++"></a>vscode调试C/C++</h2><p>安装以下工具(本地调试直接本地安装，若远程调试就ssh之后在远程安装)</p>
<ul>
<li>vscode插件<code>C/C++</code>:C/C++ IntelliSense, debugging, and code browsing.</li>
<li>vscode插件<code>Cmake Tools</code>:Extended CMake support in Visual Studio Code</li>
</ul>
<p>系统ubuntu:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y build-essential gdb cmake</span><br></pre></td></tr></table></figure>
<p>系统arch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S base-devel gdb cmake</span><br></pre></td></tr></table></figure>
<h3 id="本地单文件调试"><a href="#本地单文件调试" class="headerlink" title="本地单文件调试"></a>本地单文件调试</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># zh @ li in ~/hello [20:14:03]</span></span><br><span class="line">$ tree -a</span><br><span class="line">└── hello.c</span><br><span class="line"></span><br><span class="line"><span class="meta"># zh @ li in ~/hello [20:15:03]</span></span><br><span class="line">$ cat hello.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello world %d\n&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行-添加配置-<code>C++(GDB/LLDB)</code>-<code>gcc(/usr/bin/gcc)</code>，自动生成 launch.json 和 tasks.json 并进入调试(此时就可以打断点重新调试，在断点时，在调试控制台可以敲指令修改变量值等等的)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [21:39:07]</span></span><br><span class="line">$ tree -a</span><br><span class="line">.</span><br><span class="line">├── hello</span><br><span class="line">├── hello.c</span><br><span class="line">└── .vscode</span><br><span class="line">    ├── launch.json <span class="comment">#该文件用于调试</span></span><br><span class="line">    └── tasks.json  <span class="comment">#该文件用于编译</span></span><br><span class="line"></span><br><span class="line">1 directory, 4 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [21:43:09]</span></span><br><span class="line">$ cat .vscode/tasks.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;tasks&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;cppbuild&quot;</span>,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="string">&quot;C/C++: gcc 生成活动文件&quot;</span>,</span><br><span class="line">            <span class="string">&quot;command&quot;</span>: <span class="string">&quot;/usr/bin/gcc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;args&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;-fdiagnostics-color=always&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-g&quot;</span>,</span><br><span class="line">                <span class="string">&quot;<span class="variable">$&#123;file&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-o&quot;</span>,</span><br><span class="line">                <span class="string">&quot;<span class="variable">$&#123;fileDirname&#125;</span>/<span class="variable">$&#123;fileBasenameNoExtension&#125;</span>&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;options&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;cwd&quot;</span>: <span class="string">&quot;<span class="variable">$&#123;fileDirname&#125;</span>&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;problemMatcher&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;<span class="variable">$gcc</span>&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;group&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;build&quot;</span>,</span><br><span class="line">                <span class="string">&quot;isDefault&quot;</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;调试器生成的任务。&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;2.0.0&quot;</span></span><br><span class="line">&#125;%</span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [21:46:58]</span></span><br><span class="line">$ cat .vscode/launch.json</span><br><span class="line">&#123;</span><br><span class="line">    // 使用 IntelliSense 了解相关属性。</span><br><span class="line">    // 悬停以查看现有属性的描述。</span><br><span class="line">    // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;gcc - 生成和调试活动文件&quot;</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;cppdbg&quot;</span>,</span><br><span class="line">            <span class="string">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">            <span class="string">&quot;program&quot;</span>: <span class="string">&quot;<span class="variable">$&#123;fileDirname&#125;</span>/<span class="variable">$&#123;fileBasenameNoExtension&#125;</span>&quot;</span>, //改为编译生成的可执行文件路径</span><br><span class="line">            <span class="string">&quot;args&quot;</span>: [], //想要传给可执行文件的参数</span><br><span class="line">            <span class="string">&quot;stopAtEntry&quot;</span>: <span class="literal">false</span>, //<span class="literal">true</span>表示在main第一行断点调试</span><br><span class="line">            <span class="string">&quot;cwd&quot;</span>: <span class="string">&quot;<span class="variable">$&#123;fileDirname&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;environment&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;externalConsole&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;MIMode&quot;</span>: <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">            <span class="string">&quot;setupCommands&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;为 gdb 启用整齐打印&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;text&quot;</span>: <span class="string">&quot;-enable-pretty-printing&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;ignoreFailures&quot;</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;将反汇编风格设置为 Intel&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;text&quot;</span>: <span class="string">&quot;-gdb-set disassembly-flavor intel&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;ignoreFailures&quot;</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;preLaunchTask&quot;</span>: <span class="string">&quot;C/C++: gcc 生成活动文件&quot;</span>,</span><br><span class="line">            <span class="string">&quot;miDebuggerPath&quot;</span>: <span class="string">&quot;/usr/bin/gdb&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="本地调试cmake项目"><a href="#本地调试cmake项目" class="headerlink" title="本地调试cmake项目"></a><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/cpp/cmake-linux">本地调试cmake项目</a></h3><p><code>ctrl+shift+p</code>-<code>CMake:QuickStart</code>-<code>GCC 11.2.0 x86_64-pc-linux-gnu Using compilers:C=/usr/bin/gcc,CXX=/usr/bin/g++</code>-<code>项目名hello</code>-<code>Executable</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [22:15:38]</span></span><br><span class="line">$ tree -a -I build</span><br><span class="line">.</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── main.cpp</span><br><span class="line"></span><br><span class="line">0 directories, 2 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [22:16:16]</span></span><br><span class="line">$ cat CMakeLists.txt</span><br><span class="line">cmake_minimum_required(VERSION 3.0.0)</span><br><span class="line">project(hello VERSION 0.1.0)</span><br><span class="line"></span><br><span class="line">include(CTest)</span><br><span class="line">enable_testing()</span><br><span class="line"></span><br><span class="line">add_executable(hello main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CPACK_PROJECT_NAME <span class="variable">$&#123;PROJECT_NAME&#125;</span>)</span><br><span class="line"><span class="built_in">set</span>(CPACK_PROJECT_VERSION <span class="variable">$&#123;PROJECT_VERSION&#125;</span>)</span><br><span class="line">include(CPack)</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh @ li in ~/li/tmp/hello [22:16:23]</span></span><br><span class="line">$ cat main.cpp</span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int, char**) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello, world!\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ctrl+shift+p</code>-<code>CMake:Select a kit</code>可修改编译工具链(也可在状态栏点击修改或<code>ctrl+shift+p</code>-<code>CMake:Edit User-Local Cmake Kits</code>)</p>
<p><code>ctrl+shift+p</code>-<code>CMake:Select Variant</code>可修改编译级别类型(也可在状态栏点击修改)</p>
<p><code>ctrl+shift+p</code>-<code>CMake:Configure</code>配置项目</p>
<p><code>ctrl+shift+p</code>-<code>CMake:Build</code>构建项目(也可在状态栏点击build)默认情况是构建所有目标，可以<code>ctrl+shift+p</code>-<code>CMake:Set Build Target</code>选择要构建的目标(也可以点状态栏)</p>
<p>设置断点过后，<code>ctrl+shift+p</code>-<code>CMake:Debug</code>即可开始调试(也可按F5)</p>
<h3 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h3><ol>
<li><code>ssh-copy-id usr@ipaddr</code></li>
<li>vscode插件<code>Remote-SSH</code>:Open any folder on a remote machine using SSH and take advantage of VS Code’s full feature set.</li>
<li>vscode通过ssh登陆到远程</li>
<li>vscode搜索前面的插件，选择安装到远程</li>
<li>打开项目，调试方式跟前面的一样</li>
</ol>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2022/02/22/php%E7%AC%94%E8%AE%B0/">php笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2022-02-22T05:54:19.000Z" itemprop="datePublished">2022-02-22</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/php/" rel="tag">php</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h1 id="php小笔记"><a href="#php小笔记" class="headerlink" title="php小笔记"></a>php小笔记</h1><h2 id="php在线工具"><a href="#php在线工具" class="headerlink" title="php在线工具"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/try/runcode.php?filename=demo_intro&type=php">php在线工具</a></h2><h2 id="三目运算"><a href="#三目运算" class="headerlink" title="三目运算"></a>三目运算</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span>%<span class="number">2</span>==<span class="number">0</span> ? <span class="keyword">echo</span> <span class="string">&#x27;$a 是偶数&#x27;</span> : <span class="keyword">echo</span> <span class="string">&#x27;$a 是奇数&#x27;</span>;</span><br><span class="line"><span class="number">10</span>%<span class="number">2</span>==<span class="number">0</span> ? <span class="string">&quot;&quot;</span> : <span class="keyword">echo</span> <span class="string">&#x27;$a 是奇数&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="number">10</span>; <span class="variable">$b</span> = <span class="number">6</span>; <span class="variable">$c</span> = <span class="number">12</span>;</span><br><span class="line"><span class="variable">$x</span> = <span class="variable">$a</span>&gt;<span class="variable">$b</span> ? (<span class="variable">$a</span>&lt;<span class="variable">$c</span> ? <span class="variable">$c</span>-<span class="variable">$a</span> : <span class="variable">$a</span>-<span class="variable">$c</span>) : (<span class="variable">$b</span>&lt;<span class="variable">$c</span> ? <span class="variable">$c</span>-<span class="variable">$b</span> : <span class="variable">$b</span>-<span class="variable">$c</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$x =&#x27;</span>.<span class="variable">$x</span>; <span class="comment">//$x =2</span></span><br></pre></td></tr></table></figure>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="数组转换为字符串"><a href="#数组转换为字符串" class="headerlink" title="数组转换为字符串"></a>数组转换为字符串</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;Hello&#x27;</span>,<span class="string">&#x27;World!&#x27;</span>,<span class="string">&#x27;Beautiful&#x27;</span>,<span class="string">&#x27;Day!&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> implode(<span class="string">&quot; &quot;</span>,<span class="variable">$arr</span>).<span class="string">&quot;\n&quot;</span>; <span class="comment">//Hello World! Beautiful Day!</span></span><br><span class="line"><span class="keyword">echo</span> join(<span class="string">&quot; &quot;</span>,<span class="variable">$arr</span>).<span class="string">&quot;\n&quot;</span>; <span class="comment">//同上</span></span><br><span class="line"><span class="keyword">echo</span> implode(<span class="variable">$arr</span>).<span class="string">&quot;\n&quot;</span>; <span class="comment">//!HelloWorld!BeautifulDay!</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arrs</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="keyword">array</span>(<span class="string">&#x27;topicid&#x27;</span> =&gt; <span class="number">1</span>),</span><br><span class="line">	<span class="keyword">array</span>(<span class="string">&#x27;topicid&#x27;</span> =&gt; <span class="number">2</span>),</span><br><span class="line">	<span class="keyword">array</span>(<span class="string">&#x27;topicid&#x27;</span> =&gt; <span class="number">6</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$topicid</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">//变量赋值为空</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$arrs</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$vals</span>)&#123; <span class="variable">$topicid</span>.=<span class="variable">$vals</span>[<span class="string">&#x27;topicid&#x27;</span>].<span class="string">&#x27;,&#x27;</span>; &#125;</span><br><span class="line"><span class="keyword">echo</span> rtrim(<span class="variable">$topicid</span>, <span class="string">&#x27;,&#x27;</span>); <span class="comment">//1,2,6 使用 rtrim() 函数从字符串右端删除字符：</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串切割为数组"><a href="#字符串切割为数组" class="headerlink" title="字符串切割为数组"></a>字符串切割为数组</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&quot;hello,,world&quot;</span>;</span><br><span class="line">print_r(explode(<span class="string">&quot;,&quot;</span>, <span class="variable">$str</span>)); <span class="comment">//Array ( [0] =&gt; hello [1] =&gt; [2] =&gt; world)</span></span><br><span class="line"><span class="comment">//将字符串分割成数组，参数二将字符串从左向右每3个字符分割一次，最后的不够3个了 有几个算几个</span></span><br><span class="line">print_r(str_split(<span class="variable">$str</span>, <span class="number">3</span>)); <span class="comment">//Array ( [0] =&gt; hel [1] =&gt; lo, [2] =&gt; ,wo [3] =&gt; rld)</span></span><br><span class="line">print_r(preg_split(<span class="string">&quot;/,+/&quot;</span>, <span class="variable">$str</span>)); <span class="comment">//Array ( [0] =&gt; hello [1] =&gt; world)</span></span><br></pre></td></tr></table></figure>
<h2 id="插入元素到数组末尾"><a href="#插入元素到数组末尾" class="headerlink" title="插入元素到数组末尾"></a>插入元素到数组末尾</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="keyword">array</span>(<span class="string">&quot;red&quot;</span>,<span class="string">&quot;green&quot;</span>); array_push(<span class="variable">$a</span>,<span class="string">&quot;blue&quot;</span>,<span class="string">&quot;yellow&quot;</span>); print_r(<span class="variable">$a</span>); <span class="comment">// Array ( [0] =&gt; red [1] =&gt; green [2] =&gt; blue [3] =&gt; yellow)</span></span><br></pre></td></tr></table></figure>
<h2 id="数组相减"><a href="#数组相减" class="headerlink" title="数组相减"></a>数组相减</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a1</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="variable">$a2</span> = [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>];</span><br><span class="line">print_r(array_intersect(<span class="variable">$a1</span>, <span class="variable">$a2</span>)); <span class="comment">// Array ( [1] =&gt; 2 [3] =&gt; 4)    //交集</span></span><br><span class="line">print_r(array_diff(<span class="variable">$a1</span>, array_intersect(<span class="variable">$a1</span>, <span class="variable">$a2</span>)));  <span class="comment">// Array ( [0] =&gt; 1 [2] =&gt; 3 [4] =&gt; 5) //减去交集(差集)</span></span><br></pre></td></tr></table></figure>
<h2 id="遍历修改数组"><a href="#遍历修改数组" class="headerlink" title="遍历修改数组"></a>遍历修改数组</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$array</span>= <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> &amp;<span class="variable">$value</span>) &#123; <span class="variable">$value</span> = <span class="variable">$value</span>*<span class="number">2</span>; &#125; <span class="comment">//使用引用符号</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$value</span>); <span class="comment">//遍历后value依然引用着最后元素，可用unset取消</span></span><br><span class="line">print_r(<span class="variable">$array</span>); <span class="comment">//Array ( [0] =&gt; 2 [1] =&gt; 4 [2] =&gt; 6 [3] =&gt; 8 [4] =&gt; 10)</span></span><br></pre></td></tr></table></figure>
<h2 id="换行改为br换行"><a href="#换行改为br换行" class="headerlink" title="换行改为br换行"></a>换行改为br换行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> nl2br(<span class="string">&quot;One line.\nAnother line.&quot;</span>);</span><br><span class="line"><span class="comment">//One line.&lt;br /&gt;</span></span><br><span class="line"><span class="comment">//Another line.</span></span><br></pre></td></tr></table></figure>
<h2 id="执行shell命令"><a href="#执行shell命令" class="headerlink" title="执行shell命令"></a>执行shell命令</h2><p>这三个函数在默认的情况下，都是被禁止了的，如果要使用这几个函数，就要先修改php的配置文件php.ini，查找关键字disable_functions，将这一项中的这几个函数名删除掉，然后注意重启apache。</p>
<h3 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$last_line</span>=system(<span class="string">&quot;ping 192.168.16.1 -c1&quot;</span>, <span class="variable">$status</span>); <span class="comment">//输出到当前位置，返回最后一行字符串</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$status</span>)&#123; <span class="keyword">echo</span> <span class="string">&quot;执行失败\n&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;执行成功\n&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;last_line:&quot;</span>.<span class="variable">$last_line</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PING 192.168.16.1 (192.168.16.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.16.1: icmp_seq=1 ttl=63 time=2.37 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.16.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 2.372/2.372/2.372/0.000 ms</span><br><span class="line">执行成功</span><br><span class="line">last_line:rtt min/avg/max/mdev = 2.372/2.372/2.372/0.000 ms</span><br></pre></td></tr></table></figure>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$last_line</span>=exec(<span class="string">&quot;ping 192.168.16.1 -c1&quot;</span>, <span class="variable">$result</span>, <span class="variable">$status</span>); <span class="comment">//输出到数组$result，返回最后一行字符串</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$status</span>)&#123; <span class="keyword">echo</span> <span class="string">&quot;执行失败\n&quot;</span>;print_r(<span class="variable">$result</span>); &#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;执行成功\n&quot;</span>;print_r(<span class="variable">$result</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;last_line:&quot;</span>.<span class="variable">$last_line</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">执行成功</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; PING 192.168.16.1 (192.168.16.1) 56(84) bytes of data.</span><br><span class="line">    [1] =&gt; 64 bytes from 192.168.16.1: icmp_seq=1 ttl=63 time=2.54 ms</span><br><span class="line">    [2] =&gt;</span><br><span class="line">    [3] =&gt; --- 192.168.16.1 ping statistics ---</span><br><span class="line">    [4] =&gt; 1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">    [5] =&gt; rtt min/avg/max/mdev = 2.536/2.536/2.536/0.000 ms</span><br><span class="line">)</span><br><span class="line">last_line:rtt min/avg/max/mdev = 2.536/2.536/2.536/0.000 ms</span><br></pre></td></tr></table></figure>
<h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a>passthru()</h3><p><code>passthru(&#39;ls&#39;,$res);</code>输出到当前位置，命令执行结果存到$res,函数返回void</p>
<h2 id="form-checkbox"><a href="#form-checkbox" class="headerlink" title="form checkbox"></a>form checkbox</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--a.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;checkbox-form.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>使能: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;enable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;enabled&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;testarray[]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;apple&quot;</span> /&gt;</span>苹果<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;testarray[]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;banana&quot;</span> /&gt;</span>香蕉<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;testarray[]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cat&quot;</span> /&gt;</span>猫 <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;testarray[]&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dog&quot;</span> /&gt;</span>狗 <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;提交&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//checkbox-form.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;enable&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;enable&#x27;</span>] == <span class="string">&#x27;enabled&#x27;</span>) &#123; <span class="keyword">echo</span> <span class="string">&quot;enabled&lt;br/&gt;&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;disabled&lt;br/&gt;&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;testarray&#x27;</span>]))&#123; var_dump(<span class="variable">$_POST</span>[<span class="string">&#x27;testarray&#x27;</span>]); <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;testarray&#x27;</span>])) &#123; <span class="keyword">echo</span>(<span class="string">&quot;You select nothing.&quot;</span>); &#125; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disabled</span><br><span class="line">array(3) &#123; [0]=&gt; string(5) &quot;apple&quot; [1]=&gt; string(6) &quot;banana&quot; [2]=&gt; string(3) &quot;cat&quot; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="form-提交多维数组"><a href="#form-提交多维数组" class="headerlink" title="form 提交多维数组"></a><a target="_blank" rel="noopener" href="https://code-boxx.com/post-array-html-form/">form 提交多维数组</a></h2><h3 id="二维"><a href="#二维" class="headerlink" title="二维"></a>二维</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">array(2) &#123;</span><br><span class="line">    [&quot;params&quot;]&#x3D;&gt; array(2) &#123;</span><br><span class="line">        [0]&#x3D;&gt; array(2) &#123;</span><br><span class="line">            [&quot;a&quot;]&#x3D;&gt; string(1) &quot;1&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;2&quot; &#125;</span><br><span class="line">        [1]&#x3D;&gt; array(2) &#123;</span><br><span class="line">            [&quot;a&quot;]&#x3D;&gt; string(1) &quot;3&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;4&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="三维和关联数组"><a href="#三维和关联数组" class="headerlink" title="三维和关联数组"></a>三维和关联数组</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[hello]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[world]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][0][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][0][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][1][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[0][1][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][0][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][0][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][1][a]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;params[1][1][b]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">array(2) &#123;</span><br><span class="line">    [&quot;params&quot;]&#x3D;&gt; array(4) &#123;</span><br><span class="line">        [&quot;hello&quot;]&#x3D;&gt; string(1) &quot;h&quot;</span><br><span class="line">        [&quot;world&quot;]&#x3D;&gt; string(1) &quot;w&quot;</span><br><span class="line">        [0]&#x3D;&gt; array(2) &#123;</span><br><span class="line">            [0]&#x3D;&gt; array(2) &#123; [&quot;a&quot;]&#x3D;&gt; string(1) &quot;1&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;2&quot; &#125;</span><br><span class="line">            [1]&#x3D;&gt; array(2) &#123; [&quot;a&quot;]&#x3D;&gt; string(1) &quot;3&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;4&quot; &#125; &#125;</span><br><span class="line">        [1]&#x3D;&gt; array(2) &#123;</span><br><span class="line">            [0]&#x3D;&gt; array(2) &#123; [&quot;a&quot;]&#x3D;&gt; string(1) &quot;5&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;6&quot; &#125;</span><br><span class="line">            [1]&#x3D;&gt; array(2) &#123; [&quot;a&quot;]&#x3D;&gt; string(1) &quot;7&quot; [&quot;b&quot;]&#x3D;&gt; string(1) &quot;8&quot; &#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>html代码中,提交name数组中的key不用加引号，加引号之后后端的键值中会存在引号</li>
<li>现在更流行的做法是ajax提交，用ajax提交的时候怎么获取表单中的值呢？通过jquery提供的serialize()方法可以很方便的将所有要提交的内容拼接成url字符串，然后通过get的方式就可以提交给后台了。</li>
</ol>
<h2 id="ajax提交多维数组"><a href="#ajax提交多维数组" class="headerlink" title="ajax提交多维数组"></a>ajax提交多维数组</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line">&lt;form id=<span class="string">&quot;myForm&quot;</span> method=<span class="string">&quot;post&quot;</span> onsubmit=<span class="string">&quot;return save()&quot;</span>&gt;</span><br><span class="line">    &lt;label&gt;Favorite Colors&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fav[color][]&quot;</span> required value=<span class="string">&quot;red&quot;</span>/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fav[color][]&quot;</span> required value=<span class="string">&quot;green&quot;</span>/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fav[color][]&quot;</span> required value=<span class="string">&quot;blue&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;label&gt;Favorite Food&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fav[food][]&quot;</span> required value=<span class="string">&quot;bacon&quot;</span>/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fav[food][]&quot;</span> required value=<span class="string">&quot;eggs&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">save</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// (A) GET FORM DATA</span></span><br><span class="line">  <span class="keyword">var</span> form = document.getElementById(<span class="string">&quot;myForm&quot;</span>),</span><br><span class="line">      data = <span class="keyword">new</span> FormData(form);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (B) TO MANUALLY APPEND MORE DATA</span></span><br><span class="line">  data.append(<span class="string">&quot;address[]&quot;</span>, <span class="string">&quot;Foo Street 123&quot;</span>);</span><br><span class="line">  data.append(<span class="string">&quot;address[]&quot;</span>, <span class="string">&quot;Hello World #234&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (C) AJAX FETCH</span></span><br><span class="line">  fetch(<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;</span>, &#123; method:<span class="string">&quot;POST&quot;</span>, body:data &#125;)</span><br><span class="line">  .then(res=&gt;res.text()).then((response) =&gt; &#123;</span><br><span class="line">    console.log(response);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">array(3) &#123;</span><br><span class="line">  [&quot;fav&quot;]&#x3D;&gt; array(2) &#123;</span><br><span class="line">    [&quot;color&quot;]&#x3D;&gt; array(3) &#123;</span><br><span class="line">      [0]&#x3D;&gt; string(3) &quot;red&quot; [1]&#x3D;&gt; string(5) &quot;green&quot; [2]&#x3D;&gt; string(4) &quot;blue&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    [&quot;food&quot;]&#x3D;&gt; array(2) &#123;</span><br><span class="line">      [0]&#x3D;&gt; string(5) &quot;bacon&quot; [1]&#x3D;&gt; string(4) &quot;eggs&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;address&quot;]&#x3D;&gt; array(2) &#123;</span><br><span class="line">    [0]&#x3D;&gt; string(14) &quot;Foo Street 123&quot;</span><br><span class="line">    [1]&#x3D;&gt; string(16) &quot;Hello World #234&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果需要用json，那ajax代码改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// (A) ARRAY TO STRING</span></span><br><span class="line">  <span class="keyword">var</span> colors = [<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>];</span><br><span class="line">  colors = <span class="built_in">JSON</span>.stringify(colors);</span><br><span class="line">  <span class="built_in">console</span>.log(colors); <span class="comment">// [&quot;Red&quot;,&quot;Green&quot;,&quot;Blue&quot;]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// (B) SEND AS FLAT STRING</span></span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">new</span> FormData(form);</span><br><span class="line">  data.append(<span class="string">&quot;colors&quot;</span>, colors);</span><br><span class="line">  fetch(<span class="string">&quot;SCRIPT&quot;</span>, &#123; <span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>, <span class="attr">body</span>:data &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>后端处理代码为:<code>var_dump(json_decode($_POST[&quot;colors&quot;]));</code></p>
<h2 id="json-encode-‘-‘不转义，中文不转码"><a href="#json-encode-‘-‘不转义，中文不转码" class="headerlink" title="json_encode ‘/‘不转义，中文不转码"></a>json_encode ‘/‘不转义，中文不转码</h2><p>一般用json_encode($data,256)或json_encode($data,true) 来保证数据中的中文等特殊字符不被转码</p>
<p>如果数据中含有URL或是有转义字符（如斜杆/），这些字符将被转义，前面加上\，如：<code>http://www.xxx.com/xxxx</code> 将会被转义成<code>http:\/\/www.xxx.com\/xxxx</code> 。这种情况下，若接口方未对数据进行json_decode的话，这种URL就是不合法的，你直接在浏览器访问也会访问不到。</p>
<p>这就需要把数据转json时，既不被转义，中文也不转码，防范如下（JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE不要加引号）：</p>
<p>json_encode($data, JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE); // 斜杆（/）不转义，中文不转码</p>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2021/12/28/linux%E7%AC%94%E8%AE%B0/">linux笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2021-12-28T06:32:41.000Z" itemprop="datePublished">2021-12-28</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/linux/" rel="tag">linux</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="挂载USB-TF-SD卡是只读文件系统"><a href="#挂载USB-TF-SD卡是只读文件系统" class="headerlink" title="挂载USB/TF/SD卡是只读文件系统"></a>挂载USB/TF/SD卡是只读文件系统</h2><p>fdisk -l 查看U盘格式，如果是ntfs就安装 ntfs-3g 再试</p>
<h2 id="mount挂载ntf"><a href="#mount挂载ntf" class="headerlink" title="mount挂载ntf"></a>mount挂载ntf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs -o nolock -o tcp <span class="variable">$&#123;myip&#125;</span>:/home/xxx /mnt</span><br></pre></td></tr></table></figure>
<h2 id="解压zip出现乱码"><a href="#解压zip出现乱码" class="headerlink" title="解压zip出现乱码"></a>解压zip出现乱码</h2><p>方法1 使用unzip指定字符集</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -O CP936 xxx.zip <span class="comment">#(用GBK, GB18030也可以)</span></span><br></pre></td></tr></table></figure>
<p>方法2 修改环境变量参数</p>
<p>给<code>/etc/environment</code>添加下面2行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UNZIP=<span class="string">&quot;-O CP936&quot;</span></span><br><span class="line">ZIPINFO=<span class="string">&quot;-O CP936&quot;</span></span><br></pre></td></tr></table></figure>
<p>方法3 使用jar解压zip包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar xvf xxx.zip</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2021/11/05/ssh%E7%AC%94%E8%AE%B0/">ssh笔记</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2021-11-05T07:32:41.000Z" itemprop="datePublished">2021-11-05</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/ssh/" rel="tag">ssh</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="命令行传密码"><a href="#命令行传密码" class="headerlink" title="命令行传密码"></a>命令行传密码</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p <span class="variable">$&#123;PWD&#125;</span> ssh -o stricthostkeychecking=no root@192.168.1.1</span><br></pre></td></tr></table></figure>
<h2 id="报错处理"><a href="#报错处理" class="headerlink" title="报错处理"></a>报错处理</h2><p>Unable to negotiate with 192.168.1.254 port 22: no matching host key type found. Their offer: ssh-rsa</p>
<p>原因为：没有找到相关的主机密钥类型(ssh-rsa)。</p>
<p>解决： <code>ssh -o HostKeyAlgorithms=+ssh-rsa user@host</code> 或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat .ssh/config</span><br><span class="line">Host *</span><br><span class="line">    HostKeyAlgorithms +ssh-rsa</span><br></pre></td></tr></table></figure>
<p>同理：</p>
<p><code>...Their offer: diffie-hellman-group1-sha1</code> 解决： <code>-o KexAlgorithms=+diffie-hellman-group1-sha1</code></p>
<p><code>...Their offer: ssh-dss</code> 解决：<code>-o HostKeyAlgorithms=+ssh-dss</code></p>
<p><code>...Their offer: 3des-cbc</code> 解决：<code>-o Ciphers=+3des-cbc</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -o KexAlgorithms=+diffie-hellman-group1-sha1 -o HostKeyAlgorithms=+ssh-dss -o Ciphers=+3des-cbc user@host</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2021/10/19/linux%E7%BD%91%E7%BB%9C4_%E7%BB%84%E6%92%AD%E5%92%8CospfOverGre/">linux网络4_组播和ospfOverGre</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://humble-zh.github.io/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2021-10-19T07:32:41.000Z" itemprop="datePublished">2021-10-19</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/gre/" rel="tag">gre</a>, <a class="article-tag-link" href="/tags/linux/" rel="tag">linux</a>, <a class="article-tag-link" href="/tags/multicast/" rel="tag">multicast</a>, <a class="article-tag-link" href="/tags/ospf/" rel="tag">ospf</a>, <a class="article-tag-link" href="/tags/pim/" rel="tag">pim</a>, <a class="article-tag-link" href="/tags/%E7%BB%84%E6%92%AD/" rel="tag">组播</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="拓扑"><a href="#拓扑" class="headerlink" title="拓扑"></a>拓扑</h2><p><img src="/2021/10/19/linux%E7%BD%91%E7%BB%9C4_%E7%BB%84%E6%92%AD%E5%92%8CospfOverGre/%E7%BB%84%E6%92%AD%E5%92%8CospfOverGre%E6%8B%93%E6%89%91.jpg" alt="TOPO"></p>
<h2 id="组播源PC1"><a href="#组播源PC1" class="headerlink" title="组播源PC1"></a>组播源PC1</h2><p>定时发送<code>i am the xxth message to 239.255.255.249</code> 到组播组<code>239.255.255.249</code></p>
<h2 id="配置RouterB"><a href="#配置RouterB" class="headerlink" title="配置RouterB"></a>配置RouterB</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerB in / [15:15:39]</span></span><br><span class="line">$ iptables -t nat -D POSTROUTING 1 <span class="comment">#关闭NAT，清空nat表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [15:15:42]</span></span><br><span class="line">$ iptables -t nat -nvL  <span class="comment"># 查看nat表已清空</span></span><br><span class="line">Chain PREROUTING (policy ACCEPT 8 packets, 569 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [15:51:02]</span></span><br><span class="line">$ ip link <span class="built_in">set</span> eth0 multicast off  <span class="comment"># 关闭eth0的组播功能，确保组播走的是gre隧道</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [15:51:17]</span></span><br><span class="line">$ ip link <span class="built_in">set</span> eth1 multicast off  <span class="comment"># 关闭eth1的组播功能，确保组播走的是gre隧道</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [15:51:23]</span></span><br><span class="line">$ ip addr show eth0  <span class="comment"># 看到 &lt;&gt; 内已经没了MULTICAST</span></span><br><span class="line">2: eth0: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:e2:69:24:0b:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 20.1.1.2/24 brd 20.1.1.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::2e2:69ff:fe24:b30/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [16:18:55]</span></span><br><span class="line">$ ip addr show eth1  <span class="comment"># 看到 &lt;&gt; 内已经没了MULTICAST</span></span><br><span class="line">3: eth1: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:e2:69:24:0b:31 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 30.1.1.1/24 brd 30.1.1.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::2e2:69ff:fe24:b31/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [16:50:09]</span></span><br><span class="line">$ cat /etc/quagga/ospfd.conf  <span class="comment"># 配置ospf</span></span><br><span class="line">hostname Router_B</span><br><span class="line">password testpassword</span><br><span class="line"><span class="built_in">enable</span> password testpassword</span><br><span class="line">router ospf</span><br><span class="line">	ospf router-id 20.1.1.2</span><br><span class="line">	network 30.1.1.0/24 area 0</span><br><span class="line">	network 20.1.1.0/24 area 0</span><br><span class="line">debug ospf event</span><br><span class="line"><span class="built_in">log</span> file /usr/<span class="built_in">local</span>/etc/ospfd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [16:50:14]</span></span><br><span class="line">$ systemctl restart quagga.service  <span class="comment"># 重启quagg(ospf)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerB in / [17:00:36]</span></span><br><span class="line">$ ip r  <span class="comment"># 查看路由表</span></span><br><span class="line">20.1.1.0/24 dev eth0  proto kernel  scope link  src 20.1.1.2</span><br><span class="line">30.1.1.0/24 dev eth1  proto kernel  scope link  src 30.1.1.1</span><br></pre></td></tr></table></figure>
<h2 id="配置gre"><a href="#配置gre" class="headerlink" title="配置gre"></a>配置gre</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#routerA</span></span><br><span class="line">remoteip=30.1.1.2</span><br><span class="line">localip=20.1.1.1</span><br><span class="line">greip=10.10.10.1</span><br><span class="line">grepeerip=10.10.10.2</span><br><span class="line">grename=gre1</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#routerC</span></span><br><span class="line">remoteip=20.1.1.1</span><br><span class="line">localip=30.1.1.2</span><br><span class="line">greip=10.10.10.2</span><br><span class="line">grepeerip=10.10.10.1</span><br><span class="line">grename=gre1</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#routerA and routerC</span></span><br><span class="line">lsmod|grep ip_gre || modprobe ip_gre</span><br><span class="line"><span class="comment">#ping -c1 $&#123;remoteip&#125; || &#123; echo &quot;make sure the network is ok plz&quot;; exit 1; &#125;</span></span><br><span class="line">ip addr show <span class="variable">$&#123;grename&#125;</span> &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;grename&#125;</span> is already exist&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"></span><br><span class="line">ip tunnel add <span class="variable">$&#123;grename&#125;</span> mode gre remote <span class="variable">$&#123;remoteip&#125;</span> <span class="built_in">local</span> <span class="variable">$&#123;localip&#125;</span> ikey 1 okey 1 ttl 255;</span><br><span class="line">ip addr add <span class="variable">$&#123;greip&#125;</span> dev <span class="variable">$&#123;grename&#125;</span> peer <span class="variable">$&#123;grepeerip&#125;</span>;</span><br><span class="line">ip link <span class="built_in">set</span> <span class="variable">$&#123;grename&#125;</span> multicast on up; <span class="comment">#mtu 1400; # 注意一定要multicast on</span></span><br><span class="line">ip addr show <span class="variable">$&#123;grename&#125;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="查看gre隧道接口"><a href="#查看gre隧道接口" class="headerlink" title="查看gre隧道接口"></a>查看gre隧道接口</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerA in / [16:53:20]</span></span><br><span class="line">$ ip addr show gre1</span><br><span class="line">7: gre1@NONE: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1472 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/gre 20.1.1.1 peer 30.1.1.2</span><br><span class="line">    inet 10.10.10.1 peer 10.10.10.2/32 scope global gre1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::200:5efe:1401:101/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerC in / [16:54:38]</span></span><br><span class="line">$ ip addr show gre1</span><br><span class="line">16: gre1@NONE: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1472 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/gre 30.1.1.2 peer 20.1.1.1</span><br><span class="line">    inet 10.10.10.2 peer 10.10.10.1/32 scope global gre1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::200:5efe:1e01:102/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<h2 id="测试隧道连接"><a href="#测试隧道连接" class="headerlink" title="测试隧道连接"></a>测试隧道连接</h2><p>routerA <code>ping -I 10.10.10.1 10.10.10.2 -c2</code> 通路<br>routerC <code>ping -I 10.10.10.2 10.10.10.1 -c2</code> 通路</p>
<h2 id="配置router-A和C的ospf"><a href="#配置router-A和C的ospf" class="headerlink" title="配置router A和C的ospf"></a>配置router A和C的ospf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerA in / [16:56:48]</span></span><br><span class="line">$ cat /etc/quagga/ospfd.conf</span><br><span class="line">hostname Router_A</span><br><span class="line">password testpassword</span><br><span class="line"><span class="built_in">enable</span> password testpassword</span><br><span class="line">router ospf</span><br><span class="line">	ospf router-id 10.10.10.1  <span class="comment"># 这里用gre隧道的ip</span></span><br><span class="line">	network 10.1.1.0/24 area 0</span><br><span class="line">	network 10.10.10.0/24 area 0  <span class="comment"># 使用隧道的网段</span></span><br><span class="line">debug ospf event</span><br><span class="line"><span class="built_in">log</span> file /usr/<span class="built_in">local</span>/etc/ospfd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerA in / [17:05:03]</span></span><br><span class="line">$ systemctl restart quagga.service</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerC in / [17:06:07]</span></span><br><span class="line">$ cat /etc/quagga/ospfd.conf</span><br><span class="line">hostname Router_C</span><br><span class="line">password testpassword</span><br><span class="line"><span class="built_in">enable</span> password testpassword</span><br><span class="line">router ospf</span><br><span class="line">    ospf router-id 10.10.10.2  <span class="comment"># 这里用gre隧道的ip</span></span><br><span class="line">    network 10.2.1.0/24 area 0</span><br><span class="line">    network 10.10.10.0/24 area 0  <span class="comment"># 使用隧道的网段</span></span><br><span class="line">debug ospf event</span><br><span class="line"><span class="built_in">log</span> file /usr/<span class="built_in">local</span>/etc/ospfd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerC in / [17:06:19]</span></span><br><span class="line">$ systemctl restart quagga.service</span><br></pre></td></tr></table></figure>
<h2 id="查看ospf生成的路由"><a href="#查看ospf生成的路由" class="headerlink" title="查看ospf生成的路由"></a>查看ospf生成的路由</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerA in / [17:05:10]</span></span><br><span class="line">$ ip r</span><br><span class="line">default via 20.1.1.2 dev eth1</span><br><span class="line">10.1.1.0/24 dev eth0  proto kernel  scope link  src 10.1.1.1</span><br><span class="line">10.2.1.0/24 via 10.10.10.2 dev gre1  proto zebra  metric 20  <span class="comment"># 这条由zebra生成的就是</span></span><br><span class="line">10.10.10.2 dev gre1  proto kernel  scope link  src 10.10.10.1</span><br><span class="line">20.1.1.0/24 dev eth1  proto kernel  scope link  src 20.1.1.1</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerC in / [17:06:24]</span></span><br><span class="line">$ ip r</span><br><span class="line">default via 30.1.1.1 dev eth1</span><br><span class="line">10.1.1.0/24 via 10.10.10.1 dev gre1  proto zebra  metric 20  <span class="comment"># 这条由zebra生成的就是</span></span><br><span class="line">10.2.1.0/24 dev eth0  proto kernel  scope link  src 10.2.1.1</span><br><span class="line">10.10.10.1 dev gre1  proto kernel  scope link  src 10.10.10.2</span><br><span class="line">30.1.1.0/24 dev eth1  proto kernel  scope link  src 30.1.1.2</span><br><span class="line">192.168.255.0/24 dev eth3  proto kernel  scope link  src 192.168.255.1</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerB in / [17:00:38]</span></span><br><span class="line">$ ip r  <span class="comment"># routerB确实没有获取到gre相关路由</span></span><br><span class="line">20.1.1.0/24 dev eth0  proto kernel  scope link  src 20.1.1.2</span><br><span class="line">30.1.1.0/24 dev eth1  proto kernel  scope link  src 30.1.1.1</span><br></pre></td></tr></table></figure>
<h2 id="测试ospf路由通路"><a href="#测试ospf路由通路" class="headerlink" title="测试ospf路由通路"></a>测试ospf路由通路</h2><p>PC1 <code>ping 10.2.1.2</code> 通路<br>PC2 <code>ping 10.1.1.2</code> 通路</p>
<h2 id="配置pimd"><a href="#配置pimd" class="headerlink" title="配置pimd"></a>配置pimd</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerA in / [17:09:14]</span></span><br><span class="line">$ diff -rauN /etc/pimd.conf.bak /etc/pimd.conf</span><br><span class="line">--- /etc/pimd.conf.bak	2021-10-18 16:43:11.313255253 +0800</span><br><span class="line">+++ /etc/pimd.conf	2021-10-19 15:41:13.738745717 +0800</span><br><span class="line">@@ -132,7 +132,7 @@</span><br><span class="line"> <span class="comment">#group-prefix 224.0.0.0 masklen 4</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Static rendez-vous point</span></span><br><span class="line">-<span class="comment">#rp-address 192.168.10.1 224.0.0.0/4  # 自选举方式</span></span><br><span class="line">+rp-address 10.10.10.1 224.0.0.0/4  <span class="comment"># 自选举太慢，手动指定汇聚点(这里用gre接口ip,也可用routerA的eth0的ip 10.1.1.1)</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Switch to shortest-path tree after first packet, but only after 100 sec.</span></span><br><span class="line"> spt-threshold packets 0 interval 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerA in / [17:20:01]</span></span><br><span class="line">$ systemctl restart pimd.service</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerC in / [17:10:07]</span></span><br><span class="line">$ diff -rauN /etc/pimd.conf.bak /etc/pimd.conf</span><br><span class="line">--- /etc/pimd.conf.bak	2021-09-27 14:49:18.706881067 +0800</span><br><span class="line">+++ /etc/pimd.conf	2021-10-19 15:40:35.242644448 +0800</span><br><span class="line">@@ -112,7 +112,9 @@</span><br><span class="line"></span><br><span class="line"> <span class="comment"># By default, all non-loopback multicast capable interfaces are enabled.</span></span><br><span class="line"> <span class="comment"># If you want to use loopback, set the interface multicast flag on it.</span></span><br><span class="line">-<span class="comment">#phyint eth0 disable</span></span><br><span class="line">+phyint eth3 <span class="built_in">disable</span>  <span class="comment"># 关闭不想要进行组播的端口</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># IGMP default query interval and querier timeout.  The latter should</span></span><br><span class="line"> <span class="comment"># per RFC always be (robustness * interval) + (query-response / 2), for</span></span><br><span class="line">@@ -132,7 +134,7 @@</span><br><span class="line"> <span class="comment">#group-prefix 224.0.0.0 masklen 4</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Static rendez-vous point</span></span><br><span class="line">-<span class="comment">#rp-address 192.168.10.1 224.0.0.0/4  # 自选举方式</span></span><br><span class="line">+rp-address 10.10.10.1 224.0.0.0/4  <span class="comment"># 自选举太慢，手动指定汇聚点(这里用gre接口ip,也可用routerA的eth0的ip 10.1.1.1)</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Switch to shortest-path tree after first packet, but only after 100 sec.</span></span><br><span class="line"> spt-threshold packets 0 interval 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerC in / [17:22:37]</span></span><br><span class="line">$ systemctl restart pimd.service</span><br></pre></td></tr></table></figure>
<h2 id="查看组播路由"><a href="#查看组播路由" class="headerlink" title="查看组播路由"></a>查看组播路由</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerA in / [17:22:13]</span></span><br><span class="line">$ pimd -r</span><br><span class="line">Virtual Interface Table ======================================================</span><br><span class="line">Vif  Local Address    Subnet              Thresh  Flags      Neighbors</span><br><span class="line">---  ---------------  ------------------  ------  ---------  -----------------</span><br><span class="line">  0  10.1.1.1         10.1.1/24                1  DR NO-NBR</span><br><span class="line">  1  20.1.1.1         20.1.1/24                1  DR NO-NBR</span><br><span class="line">  2  10.10.10.1       10.10.10.1/32            1  PIM        10.10.10.2</span><br><span class="line">  3  10.1.1.1         register_vif0            1</span><br><span class="line"></span><br><span class="line"> Vif  SSM Group        Sources</span><br><span class="line"></span><br><span class="line">Multicast Routing Table ======================================================</span><br><span class="line">----------------------------------- (*,G) ------------------------------------</span><br><span class="line">Source           Group            RP Address       Flags</span><br><span class="line">---------------  ---------------  ---------------  ---------------------------</span><br><span class="line">INADDR_ANY       239.255.255.249  10.10.10.1       WC RP</span><br><span class="line">Joined   oifs: ..j.</span><br><span class="line">Pruned   oifs: ....</span><br><span class="line">Leaves   oifs: ....</span><br><span class="line">Asserted oifs: ....</span><br><span class="line">Outgoing oifs: ..o.</span><br><span class="line">Incoming     : ...I</span><br><span class="line"></span><br><span class="line">TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3</span><br><span class="line">           200    55     0       0        0  0 200  0</span><br><span class="line">----------------------------------- (S,G) ------------------------------------</span><br><span class="line">Source           Group            RP Address       Flags</span><br><span class="line">---------------  ---------------  ---------------  ---------------------------</span><br><span class="line">10.1.1.2         239.255.255.249  10.10.10.1       SPT CACHE SG</span><br><span class="line">Joined   oifs: ..jj</span><br><span class="line">Pruned   oifs: ....</span><br><span class="line">Leaves   oifs: ....</span><br><span class="line">Asserted oifs: ....</span><br><span class="line">Outgoing oifs: ..oo</span><br><span class="line">Incoming     : I...</span><br><span class="line"></span><br><span class="line">TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3</span><br><span class="line">           165    20     0       0        0  0 140  0</span><br><span class="line">Source           Group            RP Address       Flags</span><br><span class="line">---------------  ---------------  ---------------  ---------------------------</span><br><span class="line">10.10.10.1       239.255.255.249  10.10.10.1       RP SG</span><br><span class="line">Joined   oifs: ....</span><br><span class="line">Pruned   oifs: ..p.</span><br><span class="line">Leaves   oifs: ....</span><br><span class="line">Asserted oifs: ....</span><br><span class="line">Outgoing oifs: ....</span><br><span class="line">Incoming     : ...I</span><br><span class="line"></span><br><span class="line">TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3</span><br><span class="line">           205    55     0       0        0  0  0  0</span><br><span class="line">--------------------------------- (*,*,G) ------------------------------------</span><br><span class="line">Number of Groups: 1</span><br><span class="line">Number of Cache MIRRORs: 1</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerA in / [17:24:23]</span></span><br><span class="line">$ ip mroute show  <span class="comment"># 看到PC1发的组播239.255.255.249数据从eth0进来，从gre1出去</span></span><br><span class="line">(10.1.1.2, 239.255.255.249)      Iif: eth0       Oifs: gre1 pimreg</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ routerC in / [17:26:09]</span></span><br><span class="line">$ pimd -r</span><br><span class="line">Virtual Interface Table ======================================================</span><br><span class="line">Vif  Local Address    Subnet              Thresh  Flags      Neighbors</span><br><span class="line">---  ---------------  ------------------  ------  ---------  -----------------</span><br><span class="line">  0  10.2.1.1         10.2.1/24                1  DR NO-NBR</span><br><span class="line">  1  30.1.1.2         30.1.1/24                1  DR NO-NBR</span><br><span class="line">  2  192.168.255.1    192.168.255              1  DISABLED</span><br><span class="line">  3  10.10.10.2       10.10.10.2/32            1  DR PIM     10.10.10.1</span><br><span class="line">  4  10.2.1.1         register_vif0            1</span><br><span class="line"></span><br><span class="line"> Vif  SSM Group        Sources</span><br><span class="line"></span><br><span class="line">Multicast Routing Table ======================================================</span><br><span class="line">----------------------------------- (*,G) ------------------------------------</span><br><span class="line">Source           Group            RP Address       Flags</span><br><span class="line">---------------  ---------------  ---------------  ---------------------------</span><br><span class="line">INADDR_ANY       239.255.255.249  10.10.10.1       WC RP</span><br><span class="line">Joined   oifs: .....</span><br><span class="line">Pruned   oifs: .....</span><br><span class="line">Leaves   oifs: l....</span><br><span class="line">Asserted oifs: .....</span><br><span class="line">Outgoing oifs: o....</span><br><span class="line">Incoming     : ...I.</span><br><span class="line"></span><br><span class="line">TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4</span><br><span class="line">             0    55     0       0        0  0  0  0  0</span><br><span class="line">----------------------------------- (S,G) ------------------------------------</span><br><span class="line">Source           Group            RP Address       Flags</span><br><span class="line">---------------  ---------------  ---------------  ---------------------------</span><br><span class="line">10.10.10.1       239.255.255.249  10.10.10.1       SPT CACHE SG</span><br><span class="line">Joined   oifs: ....j</span><br><span class="line">Pruned   oifs: ....p</span><br><span class="line">Leaves   oifs: l....</span><br><span class="line">Asserted oifs: .....</span><br><span class="line">Outgoing oifs: o....</span><br><span class="line">Incoming     : ...I.</span><br><span class="line"></span><br><span class="line">TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4</span><br><span class="line">           195    55     1       0        0  0  0  0  0</span><br><span class="line">--------------------------------- (*,*,G) ------------------------------------</span><br><span class="line">Number of Groups: 1</span><br><span class="line">Number of Cache MIRRORs: 1</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ routerC in / [17:26:10]</span></span><br><span class="line">$ ip mroute show  <span class="comment"># 看到组播239.255.255.249数据从gre1进来，从eth0出去发给PC2</span></span><br><span class="line">(10.10.10.1, 239.255.255.249)    Iif: gre1       Oifs: eth0 pimreg</span><br></pre></td></tr></table></figure>
<h2 id="接收端PC2"><a href="#接收端PC2" class="headerlink" title="接收端PC2"></a>接收端PC2</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zh @ li in ~ [17:35:30]</span></span><br><span class="line">$ ./rcver 239.255.255.249 enp2s0</span><br><span class="line">---MESSAGE FROM:10.2.1.1:44853---</span><br><span class="line">[i am the 32822th message to 239.255.255.249]</span><br><span class="line"></span><br><span class="line">---MESSAGE FROM:10.2.1.1:44853---</span><br><span class="line">[i am the 32821th message to 239.255.255.249]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
        
    </section>
</article>




<nav class="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
</nav>



            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?e4027971a230b210f4671f485b33846a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    

</body>
</html>
